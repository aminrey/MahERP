using MahERP.DataModelLayer.Entities.AcControl;
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace MahERP.DataModelLayer.Entities.TaskManagement
{
    /// <summary>
    /// ????????? ??????? ??? - ??????????? ????? ??????
    /// </summary>
    public class TaskReminderEvent
    {
        [Key]
        public int Id { get; set; }

        /// <summary>
        /// ????? ???
        /// </summary>
        public int TaskId { get; set; }
        [ForeignKey("TaskId")]
        public virtual Tasks Task { get; set; }

        /// <summary>
        /// ????? ??????????? ??????? (??????? - ???? ??????????? ??????)
        /// </summary>
        public int? ScheduleId { get; set; }
        [ForeignKey("ScheduleId")]
        public virtual TaskReminderSchedule? Schedule { get; set; }

        /// <summary>
        /// ????? ???????????? ???????
        /// </summary>
        public string RecipientUserId { get; set; }
        [ForeignKey("RecipientUserId")]
        public virtual AppUsers RecipientUser { get; set; }

        /// <summary>
        /// ????? ???????
        /// </summary>
        [Required]
        [MaxLength(200)]
        public string Title { get; set; }

        /// <summary>
        /// ??? ???????
        /// </summary>
        [Required]
        [MaxLength(1000)]
        public string Message { get; set; }

        /// <summary>
        /// ??? ???????
        /// 0 - ????? ??? ????
        /// 1 - ??????? ???????
        /// 2 - ??????? ??? ?? ????? ????
        /// 3 - ??????? ???? ???
        /// 4 - ??????? ????? ????
        /// 5 - ????? ????? ???
        /// </summary>
        public byte EventType { get; set; }

        /// <summary>
        /// ???? ????? ???????
        /// </summary>
        public DateTime ScheduledDateTime { get; set; }

        /// <summary>
        /// ??? ??????? ????? ????
        /// </summary>
        public bool IsSent { get; set; }

        /// <summary>
        /// ???? ????? ?????
        /// </summary>
        public DateTime? SentDateTime { get; set; }

        /// <summary>
        /// آیا یادآوری خوانده شده
        /// </summary>
        public bool IsRead { get; set; }

        /// <summary>
        /// تاریخ خواندن
        /// </summary>
        public DateTime? ReadDateTime { get; set; }

        /// <summary>
        /// ?????? ??????? (1 ?? 5)
        /// </summary>
        public byte Priority { get; set; } = 3;

        /// <summary>
        /// ????? ????? ??????? (?????? SMS? ????? ?????)
        /// </summary>
        public string NotificationChannel { get; set; } = "System"; // System, Email, SMS, Telegram

        /// <summary>
        /// ????? ????? ???????
        /// </summary>
        public DateTime CreateDate { get; set; } = DateTime.Now;

        /// <summary>
        /// ?????? ?? ??????? ?? ????? ???? (??????? ????? ?? ?????? ???)
        /// </summary>
        public string? CreatorUserId { get; set; }
        [ForeignKey("CreatorUserId")]
        public virtual AppUsers? Creator { get; set; }

        /// <summary>
        /// ??? ??? ?????? ???? ?????
        /// </summary>
        [NotMapped]
        public string EventTypeText => EventType switch
        {
            0 => "????? ??? ????",
            1 => "??????? ???????",
            2 => "??????? ??? ?? ????? ????",
            3 => "??????? ???? ???",
            4 => "??????? ????? ????",
            5 => "????? ????? ???",
            _ => "??????"
        };

        /// <summary>
        /// ???? CSS ???? ????? ??????
        /// </summary>
        [NotMapped]
        public string PriorityClass => Priority switch
        {
            1 => "text-success",      // ??
            2 => "text-info",         // ????? ?????
            3 => "text-warning",      // ?????
            4 => "text-danger",       // ????
            5 => "text-danger fw-bold", // ??????
            _ => "text-muted"
        };
    }
}