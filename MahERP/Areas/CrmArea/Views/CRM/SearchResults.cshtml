@model IEnumerable<CRMInteractionViewModel>
@{
    ViewData["Title"] = "نتایج جستجو - تعاملات CRM";
}

<!-- Hero -->
<div class="bg-body-light">
    <div class="content content-full">
        <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center">
            <h1 class="flex-grow-1 fs-3 fw-semibold my-2 my-sm-3">نتایج جستجو</h1>
            <nav class="flex-shrink-0 my-2 my-sm-0 ms-sm-3" aria-label="نشانگر مسیر">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a asp-action="Index">تعاملات CRM</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">نتایج جستجو</li>
                </ol>
            </nav>
        </div>
    </div>
</div>
<!-- END Hero -->

<!-- Page Content -->
<div class="content">
    <!-- Search Summary -->
    <div class="block block-rounded">
        <div class="block-header block-header-default">
            <h3 class="block-title">خلاصه جستجو</h3>
            <div class="block-options">
                <a asp-action="Index" class="btn btn-sm btn-alt-secondary">
                    <i class="fa fa-arrow-left opacity-50 me-1"></i> بازگشت به لیست اصلی
                </a>
            </div>
        </div>
        <div class="block-content">
            <div class="row text-center">
                <div class="col-6 col-md-3">
                    <div class="fs-2 fw-bold text-primary">@Model.Count()</div>
                    <div class="fs-sm fw-semibold text-muted text-uppercase">نتایج یافت شده</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="fs-2 fw-bold text-success">@Model.Count(m => m.Result == 1)</div>
                    <div class="fs-sm fw-semibold text-muted text-uppercase">تعامل موفق</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="fs-2 fw-bold text-warning">@Model.Count(m => m.Result == 2)</div>
                    <div class="fs-sm fw-semibold text-muted text-uppercase">نیاز به پیگیری</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="fs-2 fw-bold text-danger">@Model.Count(m => m.Result == 0)</div>
                    <div class="fs-sm fw-semibold text-muted text-uppercase">بی نتیجه</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Results -->
    <div class="block block-rounded">
        <div class="block-header block-header-default">
            <h3 class="block-title">نتایج جستجو (@Model.Count() تعامل)</h3>
        </div>
        <div class="block-content block-content-full">
            @if (!Model.Any())
            {
                <div class="alert alert-warning">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <i class="fa fa-exclamation-circle fa-2x text-warning"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h4 class="alert-heading">نتیجه‌ای یافت نشد!</h4>
                            <p class="mb-0">با معیارهای جستجوی شما هیچ تعامل CRM یافت نشد. لطفاً معیارهای جستجو را تغییر دهید.</p>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover table-vcenter">
                        <thead>
                            <tr>
                                <th class="text-center" style="width: 80px;">شناسه</th>
                                <th class="text-center">کد تعامل</th>
                                <th class="text-center">عنوان</th>
                                <th class="text-center d-none d-sm-table-cell">طرف حساب</th>
                                <th class="text-center d-none d-md-table-cell">نوع تعامل</th>
                                <th class="text-center d-none d-lg-table-cell">نتیجه</th>
                                <th class="text-center d-none d-xl-table-cell">تاریخ ایجاد</th>
                                <th class="text-center" style="width: 100px;">وضعیت</th>
                                <th class="text-center" style="width: 140px;">عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="text-center fs-sm">
                                        <a href="@Url.Action("Details", new { id = item.Id })">
                                            <strong>@item.Id</strong>
                                        </a>
                                    </td>
                                    <td class="text-center fw-semibold fs-sm">
                                        <a href="@Url.Action("Details", new { id = item.Id })">@item.CRMCode</a>
                                    </td>
                                    <td class="text-center fs-sm">@item.Title</td>
                                    <td class="text-center d-none d-sm-table-cell fs-sm">
                                        @(string.IsNullOrEmpty(item.StakeholderName) ? "-" : item.StakeholderName)
                                    </td>
                                    <td class="text-center d-none d-md-table-cell">
                                        @switch (item.CRMType)
                                        {
                                            case 0:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-primary-light text-primary">تماس تلفنی</span>
                                                break;
                                            case 1:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-info-light text-info">جلسه حضوری</span>
                                                break;
                                            case 2:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-warning-light text-warning">ایمیل</span>
                                                break;
                                            case 3:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-secondary-light text-secondary">پیامک</span>
                                                break;
                                            case 4:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-dark-light text-dark">سایر</span>
                                                break;
                                        }
                                    </td>
                                    <td class="text-center d-none d-lg-table-cell">
                                        @switch (item.Result)
                                        {
                                            case 0:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-danger-light text-danger">بی نتیجه</span>
                                                break;
                                            case 1:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-success-light text-success">موفق</span>
                                                break;
                                            case 2:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-warning-light text-warning">نیاز به پیگیری</span>
                                                break;
                                        }
                                    </td>
                                    <td class="text-center d-none d-xl-table-cell fs-sm">
                                        @(ConvertDateTime.ConvertMiladiToShamsi(item.CreateDate, "yyyy/MM/dd"))
                                    </td>
                                    <td class="text-center">
                                        @if (item.IsActive)
                                        {
                                            <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-success-light text-success">فعال</span>
                                        }
                                        else
                                        {
                                            <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-danger-light text-danger">غیرفعال</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group">
                                            <a href="@Url.Action("Details", new { id = item.Id })" class="btn btn-sm btn-alt-secondary" data-bs-toggle="tooltip" title="مشاهده">
                                                <i class="fa fa-fw fa-eye"></i>
                                            </a>
                                            <a href="@Url.Action("Edit", new { id = item.Id })" class="btn btn-sm btn-alt-secondary" data-bs-toggle="tooltip" title="ویرایش">
                                                <i class="fa fa-fw fa-pencil-alt"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>
<!-- END Page Content -->

@section Scripts {
    <script>
        // Initialize tooltips
        $(document).ready(function() {
            $('[data-bs-toggle="tooltip"]').tooltip();
        });
    </script>
}