@model AllModulesReportViewModel
@{
    ViewData["Title"] = "گزارش کامل دسترسی ماژول‌ها";
}

<!-- Hero -->
<div class="bg-body-light">
    <div class="content content-full">
        <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center">
            <h1 class="flex-grow-1 fs-3 fw-semibold my-2 my-sm-3">
                <i class="fa fa-chart-bar text-info me-2"></i>گزارش کامل دسترسی ماژول‌ها
            </h1>
            <nav class="flex-shrink-0 my-2 my-sm-0 ms-sm-3" aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a asp-area="AppCoreArea" asp-controller="Dashboard" asp-action="Index">داشبورد</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a asp-action="Index">دسترسی ماژول‌ها</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">گزارش کامل</li>
                </ol>
            </nav>
        </div>
    </div>
</div>

<!-- Page Content -->
<div class="content">
    <div class="row">
        @foreach (var report in Model.Reports)
        {
            <div class="col-lg-4 mb-4">
                <div class="block block-rounded h-100 border-start border-4"
                     style="border-color: @(report.ModuleType == 0 ? "#0d6efd" : report.ModuleType == 1 ? "#198754" : "#0dcaf0") !important;">
                    <div class="block-header block-header-default">
                        <h3 class="block-title">
                            <i class="@report.ModuleIcon me-2"></i>
                            @report.ModuleName
                        </h3>
                    </div>
                    <div class="block-content">
                        <!-- آمار -->
                        <div class="row text-center mb-3">
                            <div class="col-4">
                                <div class="fs-sm text-muted">کاربران</div>
                                <div class="fs-4 fw-bold text-primary">@report.DirectUsers.Count</div>
                            </div>
                            <div class="col-4">
                                <div class="fs-sm text-muted">تیم‌ها</div>
                                <div class="fs-4 fw-bold text-success">@report.Teams.Count</div>
                            </div>
                            <div class="col-4">
                                <div class="fs-sm text-muted">شعب</div>
                                <div class="fs-4 fw-bold text-info">@report.Branches.Count</div>
                            </div>
                        </div>

                        <hr>

                        <!-- جزئیات -->
                        @if (report.TotalCount > 0)
                        {
                            <!-- کاربران -->
                            @if (report.DirectUsers.Any())
                            {
                                <div class="mb-3">
                                    <h6 class="fw-bold text-primary mb-2">
                                        <i class="fa fa-user me-1"></i>کاربران (@report.DirectUsers.Count)
                                    </h6>
                                    <ul class="list-unstyled fs-sm mb-0">
                                        @foreach (var user in report.DirectUsers.Take(5))
                                        {
                                            <li class="mb-1">
                                                <i class="fa fa-check-circle text-success me-1"></i>
                                                @user
                                            </li>
                                        }
                                        @if (report.DirectUsers.Count > 5)
                                        {
                                            <li class="text-muted fst-italic">
                                                و @(report.DirectUsers.Count - 5) نفر دیگر...
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }

                            <!-- تیم‌ها -->
                            @if (report.Teams.Any())
                            {
                                <div class="mb-3">
                                    <h6 class="fw-bold text-success mb-2">
                                        <i class="fa fa-users me-1"></i>تیم‌ها (@report.Teams.Count)
                                    </h6>
                                    <ul class="list-unstyled fs-sm mb-0">
                                        @foreach (var team in report.Teams.Take(5))
                                        {
                                            <li class="mb-1">
                                                <i class="fa fa-check-circle text-success me-1"></i>
                                                @team
                                            </li>
                                        }
                                        @if (report.Teams.Count > 5)
                                        {
                                            <li class="text-muted fst-italic">
                                                و @(report.Teams.Count - 5) تیم دیگر...
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }

                            <!-- شعب -->
                            @if (report.Branches.Any())
                            {
                                <div class="mb-3">
                                    <h6 class="fw-bold text-info mb-2">
                                        <i class="fa fa-building me-1"></i>شعب (@report.Branches.Count)
                                    </h6>
                                    <ul class="list-unstyled fs-sm mb-0">
                                        @foreach (var branch in report.Branches.Take(5))
                                        {
                                            <li class="mb-1">
                                                <i class="fa fa-check-circle text-success me-1"></i>
                                                @branch
                                            </li>
                                        }
                                        @if (report.Branches.Count > 5)
                                        {
                                            <li class="text-muted fst-italic">
                                                و @(report.Branches.Count - 5) شعبه دیگر...
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }

                            <!-- جمع کل -->
                            <div class="alert alert-success mb-0">
                                <strong>جمع کل:</strong> @report.TotalCount دسترسی
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-warning mb-0">
                                <i class="fa fa-exclamation-triangle me-1"></i>
                                هیچ دسترسی فعالی وجود ندارد
                            </div>
                        }
                    </div>
                    <div class="block-content block-content-full block-content-sm bg-body-light">
                        <!-- ⭐⭐⭐ استفاده از data-toggle="modal-ajax" برای استفاده از main.js -->
                        <a href="@Url.Action("ModuleReport", "ModuleAccess")"
                           data-toggle="modal-ajax"
                           class="btn btn-sm btn-primary w-100">
                            <i class="fa fa-eye me-1"></i>مشاهده جزئیات کامل
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- دکمه بازگشت -->
    <div class="row">
        <div class="col-12">
            <a asp-action="Index" class="btn btn-alt-secondary">
                <i class="fa fa-arrow-left me-1"></i>بازگشت
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // ⭐ این کد دیگر نیاز نیست - main.js خودکار مدیریت می‌کند
        // تمام link های با data-toggle="modal-ajax" به صورت خودکار مدیریت می‌شوند
    </script>
}