@model MahERP.DataModelLayer.ViewModels.TaskListViewModel

@{
    ViewData["Title"] = "لیست تسک‌ها";
}

<div class="content">
    <!-- ⭐ Header با آمار -->
    <div class="block block-rounded">
        <div class="block-header block-header-default">
            <h3 class="block-title">
                <i class="fa fa-tasks me-1"></i>
                مدیریت تسک‌ها
            </h3>
            <div class="block-options">
                <a asp-action="CreateNewTask" class="btn btn-sm btn-alt-primary">
                    <i class="fa fa-plus me-1"></i>تسک جدید
                </a>
            </div>
        </div>
        
        <!-- ⭐⭐⭐ آمار سریع -->
        <div class="block-content">
            <div class="row g-sm">
                <div class="col-6 col-md-3">
                    <div class="p-3 bg-body-light rounded text-center">
                        <div class="fs-3 fw-semibold text-primary">@Model.Stats.TotalPending</div>
                        <div class="text-muted">در حال انجام</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="p-3 bg-body-light rounded text-center">
                        <div class="fs-3 fw-semibold text-success">@Model.Stats.TotalCompleted</div>
                        <div class="text-muted">تکمیل شده</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="p-3 bg-body-light rounded text-center">
                        <div class="fs-3 fw-semibold text-danger">@Model.Stats.TotalOverdue</div>
                        <div class="text-muted">عقب افتاده</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="p-3 bg-body-light rounded text-center">
                        <div class="fs-3 fw-semibold text-warning">@Model.Stats.TotalUrgent</div>
                        <div class="text-muted">فوری</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ⭐⭐⭐ تب‌های اصلی -->
    <div class="block block-rounded">
        <ul class="nav nav-tabs nav-tabs-block" role="tablist">
            <li class="nav-item">
                <button class="nav-link @(Model.CurrentViewType == TaskViewType.MyTasks ? "active" : "")" 
                        onclick="changeViewType(@((int)TaskViewType.MyTasks))">
                    <i class="fa fa-user me-1"></i>تسک‌های من
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link @(Model.CurrentViewType == TaskViewType.AssignedByMe ? "active" : "")" 
                        onclick="changeViewType(@((int)TaskViewType.AssignedByMe))">
                    <i class="fa fa-share-square me-1"></i>واگذار شده
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link @(Model.CurrentViewType == TaskViewType.Supervised ? "active" : "")" 
                        onclick="changeViewType(@((int)TaskViewType.Supervised))">
                    <i class="fa fa-eye me-1"></i>نظارتی
                </button>
            </li>
        </ul>
    </div>

    <!-- ⭐⭐⭐ دکمه‌های گروه‌بندی -->
    <!-- ⭐⭐⭐ دکمه‌های گروه‌بندی -->
    <div class="block block-rounded">
        <div class="block-content">
            <div class="d-flex flex-wrap gap-2">
                <button class="btn btn-sm btn-grouping @(Model.CurrentGrouping == TaskGroupingType.Team ? "btn-primary" : "btn-alt-secondary")"
                        data-grouping="@((int)TaskGroupingType.Team)"
                        onclick="changeGrouping(@((int)TaskGroupingType.Team))">
                    <i class="fa fa-users me-1"></i>تیم
                </button>
                <button class="btn btn-sm btn-grouping @(Model.CurrentGrouping == TaskGroupingType.Creator ? "btn-primary" : "btn-alt-secondary")"
                        data-grouping="@((int)TaskGroupingType.Creator)"
                        onclick="changeGrouping(@((int)TaskGroupingType.Creator))">
                    <i class="fa fa-user-tie me-1"></i>سازنده
                </button>
                <button class="btn btn-sm btn-grouping @(Model.CurrentGrouping == TaskGroupingType.CreateDate ? "btn-primary" : "btn-alt-secondary")"
                        data-grouping="@((int)TaskGroupingType.CreateDate)"
                        onclick="changeGrouping(@((int)TaskGroupingType.CreateDate))">
                    <i class="fa fa-calendar-plus me-1"></i>زمان ساخت
                </button>
                <button class="btn btn-sm btn-grouping @(Model.CurrentGrouping == TaskGroupingType.DueDate ? "btn-primary" : "btn-alt-secondary")"
                        data-grouping="@((int)TaskGroupingType.DueDate)"
                        onclick="changeGrouping(@((int)TaskGroupingType.DueDate))">
                    <i class="fa fa-calendar-check me-1"></i>زمان پایان
                </button>
                <button class="btn btn-sm btn-grouping @(Model.CurrentGrouping == TaskGroupingType.Priority ? "btn-primary" : "btn-alt-secondary")"
                        data-grouping="@((int)TaskGroupingType.Priority)"
                        onclick="changeGrouping(@((int)TaskGroupingType.Priority))">
                    <i class="fa fa-flag me-1"></i>اولویت
                </button>
            </div>
        </div>
    </div>

    <!-- ⭐⭐⭐ لیست گروه‌ها -->
    <div id="task-groups-container">
        @await Html.PartialAsync("_TaskListGroupsPartial", Model)
    </div>
</div>

@section Scripts {
    <script src="~/assets/js/TaskList.js"></script>
    <script>
        window.TaskListConfig = {
            currentViewType: @((int)Model.CurrentViewType),
            currentGrouping: @((int)Model.CurrentGrouping),
            urls: {
                changeGrouping: '@Url.Action("ChangeGrouping", "Tasks")',
                toggleComplete: '@Url.Action("ToggleTaskComplete", "Tasks")',
                deleteTask: '@Url.Action("Delete", "Tasks")'
            }
        };
    </script>
}