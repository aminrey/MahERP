@using MahERP.Extensions
@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
    var currentArea = ViewContext.RouteData.Values["area"]?.ToString();
    var taskViewType = Context.Request.Query["TaskViewType"].ToString();

    // بررسی دسترسی‌های کلی
    var isAdmin = Html.IsAdmin();
}

<!-- Sidebar -->
<nav aria-label="Main Navigation" id="sidebar">
    <!-- Side Header -->
    <div class="bg-header-dark">
        <div class="content-header bg-white-5">
            <!-- Logo -->
            <a asp-area="AdminArea" asp-controller="Dashboard" asp-action="Index" class="fw-semibold text-white tracking-wide">
                <span class="smini-visible">
                    M<span class="opacity-75">E</span>
                </span>
                <span class="smini-hidden">
                    Mah<span class="opacity-75">ERP</span>
                </span>
            </a>
            <!-- END Logo -->
            <!-- Options -->
            <div>
                <!-- Toggle Sidebar Style -->
                <button class="btn btn-sm btn-alt-secondary" data-class="fa-toggle-off fa-toggle-on" data-target="#sidebar-style-toggler" data-toggle="class-toggle" onclick="Dashmix.layout('sidebar_style_toggle');Dashmix.layout('header_style_toggle');" type="button" title="تغییر حالت نوار کناری">
                    <i class="fa fa-toggle-off" id="sidebar-style-toggler"></i>
                </button>
                <!-- END Toggle Sidebar Style -->
                <!-- Dark Mode -->
                <button class="btn btn-sm btn-alt-secondary" data-class="far fa" data-target="#dark-mode-toggler" data-toggle="class-toggle" onclick="Dashmix.layout('dark_mode_toggle');" type="button" title="حالت تاریک">
                    <i class="far fa-moon" id="dark-mode-toggler"></i>
                </button>
                <!-- END Dark Mode -->
                <!-- Close Sidebar, Visible only on mobile screens -->
                <button class="btn btn-sm btn-alt-secondary d-lg-none" data-action="sidebar_close" data-toggle="layout" type="button" title="بستن نوار کناری">
                    <i class="fa fa-times-circle"></i>
                </button>
                <!-- END Close Sidebar -->
            </div>
            <!-- END Options -->
        </div>
    </div>
    <!-- END Side Header -->
    <!-- Sidebar Scrolling -->
    <div class="js-sidebar-scroll">
        <!-- Side Navigation -->
        <div class="content-side">
            <ul class="nav-main">

                <!-- ============== 📊 DASHBOARD SECTION ============== -->
                <li class="nav-main-heading">داشبورد</li>
                <li class="nav-main-item @(IsMenuItemActive(currentController, currentAction, "Dashboard", "Index") ? "active" : "")">
                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Dashboard", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="Dashboard" asp-action="Index">
                        <i class="nav-main-link-icon fa fa-tachometer-alt text-primary"></i>
                        <span class="nav-main-link-name fw-semibold">داشبورد اصلی</span>
                    </a>
                </li>

                <!-- ============== 📋 TASK MANAGEMENT SECTION ============== -->
                @if (Html.CanAccessAny("TASK", "TASK.CREATE", "TASK.VIEW"))
                {
                    <li class="nav-main-heading">مدیریت تسک‌ها</li>
                    <li class="nav-main-item @(IsTaskMenuActive(currentController) ? "open" : "")">
                        <a aria-expanded="@(IsTaskMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                            <i class="nav-main-link-icon fa fa-tasks text-primary"></i>
                            <span class="nav-main-link-name">تسک‌ها</span>
                            <span class="nav-main-link-badge badge bg-primary rounded-pill ms-1" id="taskBadgeCount" style="display: none;">0</span>
                        </a>
                        <ul class="nav-main-submenu">

                            <!-- ⚡ عملیات سریع -->
                            <li class="nav-main-item nav-submenu-separator mt-2">
                                <div class="nav-submenu-title">
                                    <small class="text-muted fw-semibold">عملیات سریع</small>
                                </div>
                            </li>

                            @if (Html.CanAccess("TASK.CREATE"))
                            {
                                <li class="nav-main-item">
                                    <a class="nav-main-link nav-main-link-create @(IsMenuItemActive(currentController, currentAction, "Tasks", "CreateNewTask") ? "active" : "")" asp-area="AdminArea" asp-controller="Tasks" asp-action="CreateNewTask" asp-route-AddressRouteInComingUrl="side">
                                        <i class="nav-main-link-icon fa fa-plus-circle text-success"></i>
                                        <span class="nav-main-link-name fw-semibold">ایجاد تسک جدید</span>
                                    </a>
                                </li>
                            }

                            @if (Html.CanAccess("TASK.VIEW"))
                            {
                                <!-- همه تسک‌ها -->
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsTaskMenuItemActive(currentController, currentAction, taskViewType, "Tasks", "Index", "AllTasks") ? "active" : "")" asp-area="AdminArea" asp-controller="Tasks" asp-action="Index" asp-route-ViewType="AllTasks">
                                        <i class="nav-main-link-icon fa fa-list text-info"></i>
                                        <span class="nav-main-link-name">همه تسک‌ها</span>
                                    </a>
                                </li>
                            }

                            <!-- 🎯 صفحات مهم -->
                            <li class="nav-main-item nav-submenu-separator">
                                <div class="nav-submenu-title">
                                    <small class="text-muted fw-semibold">صفحات اصلی</small>
                                </div>
                            </li>

                            <!-- تسک‌های من -->
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsTaskMenuItemActive(currentController, currentAction, taskViewType, "Tasks", "Index", "MyTasks") ? "active" : "")" asp-area="AdminArea" asp-controller="Tasks" asp-action="Index" asp-route-ViewType="MyTasks">
                                    <i class="nav-main-link-icon fa fa-clipboard-check text-warning"></i>
                                    <span class="nav-main-link-name">تسک‌های من</span>
                                    <span class="nav-main-link-badge badge bg-danger rounded-pill ms-1" id="myTasksCount" style="display: none;">0</span>
                                </a>
                            </li>

                            <!-- یادآوری‌های من -->
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Tasks", "TaskReminders") ? "active" : "")" asp-area="AdminArea" asp-controller="Tasks" asp-action="TaskReminders">
                                    <i class="nav-main-link-icon fa fa-bell text-orange"></i>
                                    <span class="nav-main-link-name">یادآوری‌های من</span>
                                    <span class="nav-main-link-badge badge bg-success rounded-pill ms-1" id="remindersCount" style="display: none;">0</span>
                                </a>
                            </li>

                            <!-- تسک‌های امروز من -->
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "MyDayTask", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="MyDayTask" asp-action="Index">
                                    <i class="nav-main-link-icon fa fa-calendar-day text-success"></i>
                                    <span class="nav-main-link-name">تسک‌های روز من</span>
                                    <span class="nav-main-link-badge badge bg-success rounded-pill ms-1" id="myDayCount" style="display: none;">0</span>
                                </a>
                            </li>

                            <!-- 📅 تقویم -->
                            @if (Html.CanAccess("TASK.CALENDAR"))
                            {
                                <li class="nav-main-item nav-submenu-separator mt-2">
                                    <div class="nav-submenu-title">
                                        <small class="text-muted fw-semibold">تقویم</small>
                                    </div>
                                </li>

                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Tasks", "TaskCalendar") ? "active" : "")" asp-area="AdminArea" asp-controller="Tasks" asp-action="TaskCalendar">
                                        <i class="nav-main-link-icon fa fa-calendar text-success"></i>
                                        <span class="nav-main-link-name">تقویم تسک‌ها</span>
                                    </a>
                                </li>
                            }

                            <!-- 📊 آمار و گزارشات -->
                            @if (Html.CanAccess("TASK.DASHBOARD"))
                            {
                                <li class="nav-main-item nav-submenu-separator mt-2">
                                    <div class="nav-submenu-title">
                                        <small class="text-muted fw-semibold">آمار و گزارشات</small>
                                    </div>
                                </li>

                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Tasks", "TaskDashboard") ? "active" : "")" asp-area="AdminArea" asp-controller="Tasks" asp-action="TaskDashboard">
                                        <i class="nav-main-link-icon fa fa-chart-bar text-primary"></i>
                                        <span class="nav-main-link-name">داشبورد تسک‌ها</span>
                                    </a>
                                </li>
                            }
                        </ul>
                    </li>
                }

                <!-- ============== 🔔 NOTIFICATIONS ============== -->
                @if (Html.CanAccess("NOTIFICATION"))
                {
                    <li class="nav-main-item">
                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Notification", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="Notification" asp-action="Index">
                            <i class="nav-main-link-icon fa fa-bell text-warning"></i>
                            <span class="nav-main-link-name">نوتیفیکیشن‌ها</span>
                            <span class="nav-main-link-badge badge bg-danger rounded-pill ms-1" id="sidebarNotificationCount" style="display: none;">0</span>
                        </a>
                    </li>
                }

                <!-- ============== 🏢 ORGANIZATION SETUP ============== -->
                @if (Html.CanAccessAny("CORE.BRANCH", "CORE.TEAM", "CORE.USER"))
                {
                    <li class="nav-main-heading">تعاریف سازمانی</li>

                    <!-- مدیریت شعب -->
                    @if (Html.CanAccessAny("CORE.BRANCH", "CORE.BRANCH.USER"))
                    {
                        <li class="nav-main-item @(IsBranchMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsBranchMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                                <i class="nav-main-link-icon fa fa-sitemap text-primary"></i>
                                <span class="nav-main-link-name">مدیریت شعب</span>
                            </a>
                            <ul class="nav-main-submenu">
                                @if (Html.CanAccess("CORE.BRANCH"))
                                {
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Branch", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="Branch" asp-action="Index">
                                            <i class="nav-main-link-icon fa fa-list"></i>
                                            <span class="nav-main-link-name">لیست شعب</span>
                                        </a>
                                    </li>
                                }
                                @if (Html.CanAccess("CORE.BRANCH.CREATE"))
                                {
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Branch", "AddBranch") ? "active" : "")" asp-area="AdminArea" asp-controller="Branch" asp-action="AddBranch">
                                            <i class="nav-main-link-icon fa fa-plus-circle"></i>
                                            <span class="nav-main-link-name">افزودن شعبه جدید</span>
                                        </a>
                                    </li>
                                }
                                @if (Html.CanAccess("CORE.BRANCH.USER"))
                                {
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "BranchUser", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="BranchUser" asp-action="Index">
                                            <i class="nav-main-link-icon fa fa-users"></i>
                                            <span class="nav-main-link-name">کاربران شعب</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }

                    <!-- مدیریت تیم‌ها -->
                    @if (Html.CanAccess("CORE.TEAM"))
                    {
                        <li class="nav-main-item @(IsTeamMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsTeamMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                                <i class="nav-main-link-icon fa fa-users text-info"></i>
                                <span class="nav-main-link-name">مدیریت تیم‌ها</span>
                            </a>
                            <ul class="nav-main-submenu">
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Team", "OrganizationalChart") ? "active" : "")" asp-area="AdminArea" asp-controller="Team" asp-action="OrganizationalChart">
                                        <i class="nav-main-link-icon fa fa-sitemap"></i>
                                        <span class="nav-main-link-name">چارت سازمانی</span>
                                    </a>
                                </li>

                                @if (Html.CanAccess("CORE.TEAM.CREATE"))
                                {
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Team", "Create") ? "active" : "")" asp-area="AdminArea" asp-controller="Team" asp-action="Create">
                                            <i class="nav-main-link-icon fa fa-plus-circle"></i>
                                            <span class="nav-main-link-name">ایجاد تیم جدید</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }

                    <!-- مدیریت کاربران -->
                    @if (Html.CanAccess("CORE.USER"))
                    {
                        <li class="nav-main-item @(IsUserManagementMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsUserManagementMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                                <i class="nav-main-link-icon fa fa-user-friends text-success"></i>
                                <span class="nav-main-link-name">مدیریت کاربران</span>
                            </a>
                            <ul class="nav-main-submenu">
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "UserManager", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="UserManager" asp-action="Index">
                                        <i class="nav-main-link-icon fa fa-user-shield"></i>
                                        <span class="nav-main-link-name">مدیران سیستم</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "UserManager", "Users") ? "active" : "")" asp-area="AdminArea" asp-controller="UserManager" asp-action="Users">
                                        <i class="nav-main-link-icon fa fa-users"></i>
                                        <span class="nav-main-link-name">کاربران</span>
                                    </a>
                                </li>
                                @if (Html.CanAccess("CORE.USER.CREATE"))
                                {
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "UserManager", "AddUser") ? "active" : "")" asp-area="AdminArea" asp-controller="UserManager" asp-action="AddUser">
                                            <i class="nav-main-link-icon fa fa-user-plus"></i>
                                            <span class="nav-main-link-name">افزودن کاربر جدید</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }

                    <!-- ✅ NEW: مدیریت دسترسی‌ها و نقش‌ها - سیستم جدید -->
                    @if (Html.CanAccessAny("CORE.PERMISSION", "CORE.ROLE", "CORE.USER.PERMISSION"))
                    {
                        <li class="nav-main-item @(IsPermissionMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsPermissionMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                                <i class="nav-main-link-icon fa fa-shield-alt text-warning"></i>
                                <span class="nav-main-link-name">🔐 سیستم دسترسی‌ها</span>
                            </a>
                            <ul class="nav-main-submenu">
                                <!-- 🔑 مدیریت دسترسی‌ها -->
                                @if (Html.CanAccess("CORE.PERMISSION"))
                                {
                                    <li class="nav-main-item nav-submenu-separator">
                                        <div class="nav-submenu-title">
                                            <small class="text-muted fw-semibold">دسترسی‌ها</small>
                                        </div>
                                    </li>
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Permission", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="Permission" asp-action="Index">
                                            <i class="nav-main-link-icon fa fa-key text-primary"></i>
                                            <span class="nav-main-link-name">لیست دسترسی‌ها</span>
                                        </a>
                                    </li>
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Permission", "Tree") ? "active" : "")" asp-area="AdminArea" asp-controller="Permission" asp-action="Tree">
                                            <i class="nav-main-link-icon fa fa-sitemap text-info"></i>
                                            <span class="nav-main-link-name">درخت دسترسی‌ها</span>
                                        </a>
                                    </li>
                                    @if (Html.CanAccess("CORE.PERMISSION.CREATE"))
                                    {
                                        <li class="nav-main-item">
                                            <a class="nav-main-link nav-main-link-create @(IsMenuItemActive(currentController, currentAction, "Permission", "Create") ? "active" : "")" asp-area="AdminArea" asp-controller="Permission" asp-action="Create">
                                                <i class="nav-main-link-icon fa fa-plus-circle text-success"></i>
                                                <span class="nav-main-link-name fw-semibold">دسترسی جدید</span>
                                            </a>
                                        </li>
                                    }
                                }

                                <!-- 👥 مدیریت نقش‌ها -->
                                @if (Html.CanAccess("CORE.ROLE"))
                                {
                                    <li class="nav-main-item nav-submenu-separator mt-2">
                                        <div class="nav-submenu-title">
                                            <small class="text-muted fw-semibold">نقش‌ها</small>
                                        </div>
                                    </li>
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Role", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="Role" asp-action="Index">
                                            <i class="nav-main-link-icon fa fa-user-shield text-primary"></i>
                                            <span class="nav-main-link-name">لیست نقش‌ها</span>
                                        </a>
                                    </li>
                                    @if (Html.CanAccess("CORE.ROLE.CREATE"))
                                    {
                                        <li class="nav-main-item">
                                            <a class="nav-main-link nav-main-link-create @(IsMenuItemActive(currentController, currentAction, "Role", "Create") ? "active" : "")" asp-area="AdminArea" asp-controller="Role" asp-action="Create">
                                                <i class="nav-main-link-icon fa fa-plus-circle text-success"></i>
                                                <span class="nav-main-link-name fw-semibold">نقش جدید</span>
                                            </a>
                                        </li>
                                    }
                                }

                                <!-- 🔐 دسترسی کاربران -->
                                @if (Html.CanAccess("CORE.USER.PERMISSION"))
                                {
                                    <li class="nav-main-item nav-submenu-separator mt-2">
                                        <div class="nav-submenu-title">
                                            <small class="text-muted fw-semibold">مدیریت دسترسی کاربران</small>
                                        </div>
                                    </li>
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "UserPermission", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="UserPermission" asp-action="Index">
                                            <i class="nav-main-link-icon fa fa-users-cog text-info"></i>
                                            <span class="nav-main-link-name">دسترسی کاربران</span>
                                        </a>
                                    </li>
                                }

                                <!-- 📊 گزارشات و لاگ‌ها -->
                                @if (Html.CanAccess("CORE.PERMISSION.LOG"))
                                {
                                    <li class="nav-main-item nav-submenu-separator mt-2">
                                        <div class="nav-submenu-title">
                                            <small class="text-muted fw-semibold">گزارشات</small>
                                        </div>
                                    </li>
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "UserPermission", "ViewPermissionLogs") ? "active" : "")" asp-area="AdminArea" asp-controller="UserPermission" asp-action="ViewPermissionLogs">
                                            <i class="nav-main-link-icon fa fa-clipboard-list text-secondary"></i>
                                            <span class="nav-main-link-name">لاگ دسترسی‌ها</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }
                }

                <!-- ============== 💼 BUSINESS MANAGEMENT ============== -->
                @if (Html.CanAccessAny("ORG", "CONTACT", "CONTRACT", "CRM"))
                {
                    <li class="nav-main-heading">مدیریت کسب‌وکار</li>

                    <!-- ========== 🏢 مدیریت سازمان‌ها ========== -->
                    @if (Html.CanAccess("ORG"))
                    {
                        <li class="nav-main-item @(IsOrganizationMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsOrganizationMenuActive(currentController) ? "true" : "false")"
                               aria-haspopup="true"
                               class="nav-main-link nav-main-link-submenu"
                               data-toggle="submenu"
                               href="#">
                                <i class="nav-main-link-icon fa fa-building text-primary"></i>
                                <span class="nav-main-link-name">مدیریت سازمان‌ها</span>
                            </a>
                            <ul class="nav-main-submenu">
                                <li class="nav-main-item nav-submenu-separator">
                                    <div class="nav-submenu-title">
                                        <small class="text-muted fw-semibold">لیست سازمان‌ها</small>
                                    </div>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Organizations", "Index") && string.IsNullOrEmpty(Context.Request.Query["organizationType"]) ? "active" : "")"
                                       asp-area="AdminArea"
                                       asp-controller="Organizations"
                                       asp-action="Index">
                                        <i class="nav-main-link-icon fa fa-list text-info"></i>
                                        <span class="nav-main-link-name">همه سازمان‌ها</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsOrganizationTypeActive(currentController, currentAction, "0") ? "active" : "")"
                                       asp-area="AdminArea"
                                       asp-controller="Organizations"
                                       asp-action="Index"
                                       asp-route-organizationType="0">
                                        <i class="nav-main-link-icon fa fa-briefcase text-primary"></i>
                                        <span class="nav-main-link-name">شرکت‌ها</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsOrganizationTypeActive(currentController, currentAction, "1") ? "active" : "")"
                                       asp-area="AdminArea"
                                       asp-controller="Organizations"
                                       asp-action="Index"
                                       asp-route-organizationType="1">
                                        <i class="nav-main-link-icon fa fa-university text-info"></i>
                                        <span class="nav-main-link-name">سازمان‌ها</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsOrganizationTypeActive(currentController, currentAction, "2") ? "active" : "")"
                                       asp-area="AdminArea"
                                       asp-controller="Organizations"
                                       asp-action="Index"
                                       asp-route-organizationType="2">
                                        <i class="nav-main-link-icon fa fa-landmark text-success"></i>
                                        <span class="nav-main-link-name">موسسات</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsOrganizationTypeActive(currentController, currentAction, "3") ? "active" : "")"
                                       asp-area="AdminArea"
                                       asp-controller="Organizations"
                                       asp-action="Index"
                                       asp-route-organizationType="3">
                                        <i class="nav-main-link-icon fa fa-hands-helping text-warning"></i>
                                        <span class="nav-main-link-name">نهادها</span>
                                    </a>
                                </li>

                                @if (Html.CanAccess("ORG.CREATE"))
                                {
                                    <li class="nav-main-item nav-submenu-separator mt-2">
                                        <div class="nav-submenu-title">
                                            <small class="text-muted fw-semibold">عملیات</small>
                                        </div>
                                    </li>
                                    <li class="nav-main-item">
                                        <a class="nav-main-link nav-main-link-create @(IsMenuItemActive(currentController, currentAction, "Organizations", "Create") ? "active" : "")"
                                           asp-area="AdminArea"
                                           asp-controller="Organizations"
                                           asp-action="Create">
                                            <i class="nav-main-link-icon fa fa-plus-circle text-success"></i>
                                            <span class="nav-main-link-name fw-semibold">سازمان جدید</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }

                    <!-- ========== 👥 مدیریت افراد ========== -->
                    @if (Html.CanAccess("CONTACT"))
                    {
                        <li class="nav-main-item @(IsContactMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsContactMenuActive(currentController) ? "true" : "false")"
                               aria-haspopup="true"
                               class="nav-main-link nav-main-link-submenu"
                               data-toggle="submenu"
                               href="#">
                                <i class="nav-main-link-icon fa fa-users text-success"></i>
                                <span class="nav-main-link-name">مدیریت افراد</span>
                            </a>
                            <ul class="nav-main-submenu">
                                <li class="nav-main-item nav-submenu-separator">
                                    <div class="nav-submenu-title">
                                        <small class="text-muted fw-semibold">لیست‌ها</small>
                                    </div>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Contacts", "Index") ? "active" : "")"
                                       asp-area="AdminArea"
                                       asp-controller="Contacts"
                                       asp-action="Index">
                                        <i class="nav-main-link-icon fa fa-list text-info"></i>
                                        <span class="nav-main-link-name">همه افراد</span>
                                    </a>
                                </li>

                                @if (Html.CanAccess("CONTACT.CREATE"))
                                {
                                    <li class="nav-main-item nav-submenu-separator mt-2">
                                        <div class="nav-submenu-title">
                                            <small class="text-muted fw-semibold">عملیات</small>
                                        </div>
                                    </li>
                                    <li class="nav-main-item">
                                        <a class="nav-main-link nav-main-link-create @(IsMenuItemActive(currentController, currentAction, "Contacts", "Create") ? "active" : "")"
                                           asp-area="AdminArea"
                                           asp-controller="Contacts"
                                           asp-action="Create">
                                            <i class="nav-main-link-icon fa fa-user-plus text-success"></i>
                                            <span class="nav-main-link-name fw-semibold">فرد جدید</span>
                                        </a>
                                    </li>
                                }

                                @if (Html.CanAccess("CONTACT.STATISTICS"))
                                {
                                    <li class="nav-main-item nav-submenu-separator mt-2">
                                        <div class="nav-submenu-title">
                                            <small class="text-muted fw-semibold">آمار و گزارشات</small>
                                        </div>
                                    </li>
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Contacts", "Statistics") ? "active" : "")"
                                           asp-area="AdminArea"
                                           asp-controller="Contacts"
                                           asp-action="Statistics">
                                            <i class="nav-main-link-icon fa fa-chart-pie text-primary"></i>
                                            <span class="nav-main-link-name">آمار افراد</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }

                    <!-- قراردادها -->
                    @if (Html.CanAccess("CONTRACT"))
                    {
                        <li class="nav-main-item @(IsContractMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsContractMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                                <i class="nav-main-link-icon fa fa-file-contract text-info"></i>
                                <span class="nav-main-link-name">قراردادها</span>
                            </a>
                            <ul class="nav-main-submenu">
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Contract", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="Contract" asp-action="Index">
                                        <i class="nav-main-link-icon fa fa-list"></i>
                                        <span class="nav-main-link-name">لیست قراردادها</span>
                                    </a>
                                </li>

                                @if (Html.CanAccess("CONTRACT.CREATE"))
                                {
                                    <li class="nav-main-item">
                                        <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Contract", "AddContract") ? "active" : "")" asp-area="AdminArea" asp-controller="Contract" asp-action="AddContract">
                                            <i class="nav-main-link-icon fa fa-plus-circle"></i>
                                            <span class="nav-main-link-name">قرارداد جدید</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }

                    <!-- مدیریت CRM -->
                    @if (Html.CanAccess("CRM"))
                    {
                        <li class="nav-main-item @(IsCRMMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsCRMMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                                <i class="nav-main-link-icon fa fa-chart-line text-success"></i>
                                <span class="nav-main-link-name">مدیریت CRM</span>
                            </a>
                            <ul class="nav-main-submenu">
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "CRM", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="CRM" asp-action="Index">
                                        <i class="nav-main-link-icon fa fa-tachometer-alt"></i>
                                        <span class="nav-main-link-name">داشبورد CRM</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "CRM", "LeadManagement") ? "active" : "")" asp-area="AdminArea" asp-controller="CRM" asp-action="LeadManagement">
                                        <i class="nav-main-link-icon fa fa-user-plus"></i>
                                        <span class="nav-main-link-name">مدیریت سرنخ‌ها</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "CRM", "OpportunityManagement") ? "active" : "")" asp-area="AdminArea" asp-controller="CRM" asp-action="OpportunityManagement">
                                        <i class="nav-main-link-icon fa fa-bullseye"></i>
                                        <span class="nav-main-link-name">مدیریت فرصت‌ها</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "CRM", "CustomerFollowUp") ? "active" : "")" asp-area="AdminArea" asp-controller="CRM" asp-action="CustomerFollowUp">
                                        <i class="nav-main-link-icon fa fa-phone"></i>
                                        <span class="nav-main-link-name">پیگیری مشتریان</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "CRM", "SalesReports") ? "active" : "")" asp-area="AdminArea" asp-controller="CRM" asp-action="SalesReports">
                                        <i class="nav-main-link-icon fa fa-chart-bar"></i>
                                        <span class="nav-main-link-name">گزارشات فروش</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    }
                }

                <!-- ============== 📨 COMMUNICATION MANAGEMENT ============== -->
                @if (isAdmin)
                {
                    <li class="nav-main-heading">مدیریت ارتباطات</li>

                    <!-- مدیریت پیامک -->
                    <li class="nav-main-item @(IsSmsMenuActive(currentController) ? "open" : "")">
                        <a aria-expanded="@(IsSmsMenuActive(currentController) ? "true" : "false")"
                           aria-haspopup="true"
                           class="nav-main-link nav-main-link-submenu"
                           data-toggle="submenu"
                           href="#">
                            <i class="nav-main-link-icon fa fa-sms text-info"></i>
                            <span class="nav-main-link-name">مدیریت پیامک</span>
                        </a>
                        <ul class="nav-main-submenu">
                            <li class="nav-main-item nav-submenu-separator">
                                <div class="nav-submenu-title">
                                    <small class="text-muted fw-semibold">ارسال پیامک</small>
                                </div>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "SmsSend", "Index") ? "active" : "")"
                                   asp-area="AdminArea"
                                   asp-controller="SmsSend"
                                   asp-action="Index">
                                    <i class="nav-main-link-icon fa fa-paper-plane text-primary"></i>
                                    <span class="nav-main-link-name">ارسال پیامک</span>
                                </a>
                            </li>
                            <li class="nav-main-item nav-submenu-separator mt-2">
                                <div class="nav-submenu-title">
                                    <small class="text-muted fw-semibold">قالب‌های پیامک</small>
                                </div>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "SmsTemplate", "Index") ? "active" : "")"
                                   asp-area="AdminArea"
                                   asp-controller="SmsTemplate"
                                   asp-action="Index">
                                    <i class="nav-main-link-icon fa fa-file-alt text-info"></i>
                                    <span class="nav-main-link-name">لیست قالب‌ها</span>
                                </a>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link nav-main-link-create @(IsMenuItemActive(currentController, currentAction, "SmsTemplate", "Create") ? "active" : "")"
                                   asp-area="AdminArea"
                                   asp-controller="SmsTemplate"
                                   asp-action="Create">
                                    <i class="nav-main-link-icon fa fa-plus-circle text-success"></i>
                                    <span class="nav-main-link-name fw-semibold">قالب جدید</span>
                                </a>
                            </li>
                            <li class="nav-main-item nav-submenu-separator mt-2">
                                <div class="nav-submenu-title">
                                    <small class="text-muted fw-semibold">تنظیمات</small>
                                </div>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "SmsProvider", "Index") ? "active" : "")"
                                   asp-area="AdminArea"
                                   asp-controller="SmsProvider"
                                   asp-action="Index">
                                    <i class="nav-main-link-icon fa fa-server text-warning"></i>
                                    <span class="nav-main-link-name">خدمات‌دهندگان پیامک</span>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <!-- مدیریت ایمیل -->
                    <li class="nav-main-item @(IsEmailMenuActive(currentController) ? "open" : "")">
                        <a aria-expanded="@(IsEmailMenuActive(currentController) ? "true" : "false")"
                           aria-haspopup="true"
                           class="nav-main-link nav-main-link-submenu"
                           data-toggle="submenu"
                           href="#">
                            <i class="nav-main-link-icon fa fa-envelope text-primary"></i>
                            <span class="nav-main-link-name">مدیریت ایمیل</span>
                        </a>
                        <ul class="nav-main-submenu">
                            <li class="nav-main-item nav-submenu-separator">
                                <div class="nav-submenu-title">
                                    <small class="text-muted fw-semibold">ارسال ایمیل</small>
                                </div>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "EmailSend", "Index") ? "active" : "")"
                                   asp-area="AdminArea"
                                   asp-controller="EmailSend"
                                   asp-action="Index">
                                    <i class="nav-main-link-icon fa fa-paper-plane text-primary"></i>
                                    <span class="nav-main-link-name">ارسال ایمیل</span>
                                </a>
                            </li>
                            <li class="nav-main-item nav-submenu-separator mt-2">
                                <div class="nav-submenu-title">
                                    <small class="text-muted fw-semibold">قالب‌های ایمیل</small>
                                </div>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "EmailTemplate", "Index") ? "active" : "")"
                                   asp-area="AdminArea"
                                   asp-controller="EmailTemplate"
                                   asp-action="Index">
                                    <i class="nav-main-link-icon fa fa-file-alt text-info"></i>
                                    <span class="nav-main-link-name">لیست قالب‌ها</span>
                                </a>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link nav-main-link-create @(IsMenuItemActive(currentController, currentAction, "EmailTemplate", "Create") ? "active" : "")"
                                   asp-area="AdminArea"
                                   asp-controller="EmailTemplate"
                                   asp-action="Create">
                                    <i class="nav-main-link-icon fa fa-plus-circle text-success"></i>
                                    <span class="nav-main-link-name fw-semibold">قالب جدید</span>
                                </a>
                            </li>
                            <li class="nav-main-item nav-submenu-separator mt-2">
                                <div class="nav-submenu-title">
                                    <small class="text-muted fw-semibold">تنظیمات</small>
                                </div>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Settings", "EmailSettings") ? "active" : "")"
                                   asp-area="AdminArea"
                                   asp-controller="Settings"
                                   asp-action="EmailSettings">
                                    <i class="nav-main-link-icon fa fa-cog text-warning"></i>
                                    <span class="nav-main-link-name">تنظیمات ایمیل</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                }

                <!-- ============== 📊 MONITORING & LOGS ============== -->
                @if (Html.CanAccess("CORE.ACTIVITYLOG"))
                {
                    <li class="nav-main-heading">نظارت و لاگ‌ها</li>

                    <li class="nav-main-item @(IsActivityLogMenuActive(currentController) ? "open" : "")">
                        <a aria-expanded="@(IsActivityLogMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                            <i class="nav-main-link-icon fa fa-history text-secondary"></i>
                            <span class="nav-main-link-name">لاگ فعالیت‌ها</span>
                        </a>
                        <ul class="nav-main-submenu">
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "UserActivityLog", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="UserActivityLog" asp-action="Index">
                                    <i class="nav-main-link-icon fa fa-list"></i>
                                    <span class="nav-main-link-name">لیست فعالیت‌ها</span>
                                </a>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "UserActivityLog", "Search") ? "active" : "")" asp-area="AdminArea" asp-controller="UserActivityLog" asp-action="Search">
                                    <i class="nav-main-link-icon fa fa-search"></i>
                                    <span class="nav-main-link-name">جستجوی پیشرفته</span>
                                </a>
                            </li>
                            <li class="nav-main-item">
                                <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "UserActivityLog", "Statistics") ? "active" : "")" asp-area="AdminArea" asp-controller="UserActivityLog" asp-action="Statistics">
                                    <i class="nav-main-link-icon fa fa-chart-line"></i>
                                    <span class="nav-main-link-name">آمار و گزارشات</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                }

                <!-- ============== 🏷️ SYSTEM CONFIGURATION ============== -->
                @if (Html.CanAccessAny("CORE.TASKCATEGORY", "SETTINGS"))
                {
                    <li class="nav-main-heading">تنظیمات سیستم</li>

                    @if (Html.CanAccess("CORE.TASKCATEGORY"))
                    {
                        <li class="nav-main-item @(IsTaskCategoryMenuActive(currentController) ? "open" : "")">
                            <a aria-expanded="@(IsTaskCategoryMenuActive(currentController) ? "true" : "false")" aria-haspopup="true" class="nav-main-link nav-main-link-submenu" data-toggle="submenu" href="#">
                                <i class="nav-main-link-icon fa fa-tags text-secondary"></i>
                                <span class="nav-main-link-name">دسته‌بندی تسک‌ها</span>
                            </a>
                            <ul class="nav-main-submenu">
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "TaskCategory", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="TaskCategory" asp-action="Index">
                                        <i class="nav-main-link-icon fa fa-list"></i>
                                        <span class="nav-main-link-name">دسته‌بندی‌های عمومی</span>
                                    </a>
                                </li>
                                <li class="nav-main-item">
                                    <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "BranchTaskCategory", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="BranchTaskCategory" asp-action="Index">
                                        <i class="nav-main-link-icon fa fa-building"></i>
                                        <span class="nav-main-link-name">دسته‌بندی‌های شعب</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    }

                    @if (Html.CanAccess("SETTINGS"))
                    {
                        <li class="nav-main-item">
                            <a class="nav-main-link @(IsMenuItemActive(currentController, currentAction, "Settings", "Index") ? "active" : "")" asp-area="AdminArea" asp-controller="Settings" asp-action="Index">
                                <i class="nav-main-link-icon fa fa-cogs text-primary"></i>
                                <span class="nav-main-link-name">تنظیمات عمومی</span>
                            </a>
                        </li>
                    }
                }

                <!-- ============== 🚪 LOGOUT ============== -->
                <li class="nav-main-heading">خروج</li>
                <li class="nav-main-item">
                    <a class="nav-main-link logout-link" href="/Account/LogOut">
                        <i class="nav-main-link-icon fa fa-sign-out-alt text-danger"></i>
                        <span class="nav-main-link-name">خروج از سیستم</span>
                    </a>
                </li>

            </ul>
        </div>
        <!-- END Side Navigation -->
    </div>
    <!-- END Sidebar Scrolling -->
</nav>
<!-- END Sidebar -->
@functions {
    public bool IsMenuItemActive(string currentController, string currentAction, string targetController, string targetAction)
    {
        return currentController == targetController && currentAction == targetAction;
    }

    public bool IsTaskMenuItemActive(string currentController, string currentAction, string taskViewType, string targetController, string targetAction, string targetViewType)
    {
        return currentController == targetController &&
               currentAction == targetAction &&
               taskViewType == targetViewType;
    }

    public bool IsTaskMenuActive(string currentController) => currentController == "Tasks";
    public bool IsBranchMenuActive(string currentController) => currentController == "Branch" || currentController == "BranchUser";
    public bool IsTeamMenuActive(string currentController) => currentController == "Team";
    public bool IsUserManagementMenuActive(string currentController) => currentController == "UserManager";
    public bool IsPermissionMenuActive(string currentController) => currentController == "Permission" || currentController == "Role" || currentController == "UserPermission";
    public bool IsOrganizationMenuActive(string currentController) => currentController == "Organizations";
    public bool IsContactMenuActive(string currentController) => currentController == "Contacts";
    public bool IsContractMenuActive(string currentController) => currentController == "Contract";
    public bool IsCRMMenuActive(string currentController) => currentController == "CRM";
    public bool IsActivityLogMenuActive(string currentController) => currentController == "UserActivityLog";
    public bool IsTaskCategoryMenuActive(string currentController) => currentController == "TaskCategory" || currentController == "BranchTaskCategory";
    public bool IsSmsMenuActive(string currentController) => currentController == "SmsSend" || currentController == "SmsTemplate" || currentController == "SmsProvider";
    public bool IsEmailMenuActive(string currentController) => currentController == "EmailSend" || currentController == "EmailTemplate";

    public bool IsOrganizationTypeActive(string currentController, string currentAction, string organizationType)
    {
        if (currentController != "Organizations" || currentAction != "Index")
            return false;

        var queryOrgType = Context.Request.Query["organizationType"].ToString();
        return queryOrgType == organizationType;
    }
}

<!-- JavaScript for Sidebar Functionality -->
<script>
    function loadAdvancedSearchModal() {
        createAndShowModal('@Url.Action("AdvancedSearch", "Stakeholder", new { area = "AdminArea" })');
    }

    function loadTaskAdvancedSearchModal() {
        createAndShowModal('@Url.Action("AdvancedSearch", "Tasks", new { area = "AdminArea" })');
    }

    function createAndShowModal(url) {
        $('#advanced-search-content, #advanced-search-task-content').html(`
            <div class="modal-body text-center">
                <div class="d-flex justify-content-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">در حال بارگذاری...</span>
                    </div>
                </div>
                <p class="mt-3">در حال بارگذاری...</p>
            </div>
        `);

        $.get(url, function(data) {
            if (url.includes('Tasks')) {
                $('#advanced-search-task-content').html(data);
            } else {
                $('#advanced-search-content').html(data);
            }
        }).fail(function() {
            const errorContent = `
                <div class="modal-body text-center">
                    <div class="alert alert-danger">
                        <i class="fa fa-exclamation-triangle me-2"></i>
                        خطا در بارگذاری محتوا. لطفاً دوباره تلاش کنید.
                    </div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>
            `;
            if (url.includes('Tasks')) {
                $('#advanced-search-task-content').html(errorContent);
            } else {
                $('#advanced-search-content').html(errorContent);
            }
        });
    }

    $(document).ready(function() {
        updateTaskCounts();
        updateMyDayCount();
        setInterval(function() {
            updateTaskCounts();
            updateMyDayCount();
        }, 120000);
    });

    function updateTaskCounts() {
        $.get('@Url.Action("GetDashboardSummary", "Dashboard", new { area = "AdminArea" })')
            .done(function(response) {
                if (response.success) {
                    updateBadgeCount('#myTasksCount', response.tasksStats.myTasksCount);
                    updateBadgeCount('#assignedByMeCount', response.tasksStats.assignedByMeCount);
                    updateBadgeCount('#supervisedTasksCount', response.tasksStats.supervisedTasksCount);
                    updateBadgeCount('#remindersCount', response.tasksStats.remindersCount);
                    updateBadgeCount('#taskBadgeCount', response.tasksStats.myTasksCount + response.tasksStats.remindersCount);
                }
            });
    }

    function updateMyDayCount() {
        $.get('@Url.Action("GetMyDayTasksCount", "Tasks", new { area = "AdminArea" })').done(function(data) {
            if (data.success) {
                updateBadgeCount('#myDayCount', data.count);
            }
        });
    }

    function updateBadgeCount(selector, count) {
        const badge = $(selector);
        if (count > 0) {
            badge.text(count).show();
        } else {
            badge.hide();
        }
    }

    $('.nav-main-link').on('click', function(e) {
        if ($(this).hasClass('nav-main-link-submenu')) return;
        const icon = $(this).find('.nav-main-link-icon');
        const originalIcon = icon.attr('class');
        icon.attr('class', 'nav-main-link-icon fa fa-spinner fa-spin');
        setTimeout(() => {
            icon.attr('class', originalIcon);
        }, 1000);
    });
</script>

<!-- Enhanced Styles - باقی مانده مشابه قبل... -->
<style>
    /* همان CSS های قبلی */
    .nav-submenu-separator {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 0.5rem;
        margin-top: 0.5rem;
    }

    .nav-submenu-separator:first-child {
        border-top: none;
        padding-top: 0;
        margin-top: 0;
    }

    .nav-submenu-title {
        padding: 0.25rem 1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .nav-main-link-badge {
        animation: badgePulse 2s infinite;
        font-size: 0.625rem;
        min-width: 1.25rem;
        height: 1.25rem;
        line-height: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    @@keyframes badgePulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    .text-orange { color: #fd7e14 !important; }
    .text-purple { color: #6f42c1 !important; }

    .nav-main-link {
        transition: all 0.3s ease;
        border-radius: 0.375rem;
        margin: 0.125rem 0.5rem;
    }

    .nav-main-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        transform: translateX(-2px);
    }

    .nav-main-link-create {
        background: linear-gradient(135deg, rgba(25, 135, 84, 0.1), rgba(25, 135, 84, 0.2));
        border-left: 3px solid #198754;
    }

    .nav-main-link-create:hover {
        background: linear-gradient(135deg, rgba(25, 135, 84, 0.2), rgba(25, 135, 84, 0.3));
    }

    .logout-link {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.2));
        border-left: 3px solid #dc3545;
    }

    .logout-link:hover {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.2), rgba(220, 53, 69, 0.3));
    }

    @@media (max-width: 991.98px) {
        .nav-main-link-name { font-size: 0.875rem; }
        .nav-submenu-title small { font-size: 0.7rem; }
    }

    .nav-main-link.loading .nav-main-link-icon {
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .nav-main-heading {
        position: relative;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: rgba(255, 255, 255, 0.8);
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        padding: 0 1rem;
    }

    .nav-main-heading:first-child {
        margin-top: 0.5rem;
    }

    .nav-main-heading::after {
        content: '';
        position: absolute;
        bottom: -0.25rem;
        left: 1rem;
        right: 1rem;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    }
</style>