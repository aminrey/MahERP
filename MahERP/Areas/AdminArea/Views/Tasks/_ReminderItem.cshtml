@model MahERP.DataModelLayer.ViewModels.taskingModualsViewModels.TaskReminderViewModel

@{
    var reminderId = ViewBag.ReminderId ?? DateTime.Now.Ticks;

    string typeText = Model.ReminderType switch
    {
        1 => "تکراری",
        2 => "قبل از مهلت",
        0 => "یکبار",
        3 => "روز شروع",
        4 => "روز پایان",
        _ => "نامشخص"
    };

    string scheduleText = Model.ReminderType switch
    {
        1 => $"هر {Model.IntervalDays ?? 0} روز",
        2 => $"{Model.DaysBeforeDeadline ?? 0} روز قبل",
        0 => !string.IsNullOrEmpty(Model.StartDatePersian) ? $"در {Model.StartDatePersian}" : "در زمان مشخص",
        3 => "در روز شروع تسک",
        4 => "در روز پایان مهلت",
        _ => "نامشخص"
    };

    // زمان نوتیفیکیشن
    string notificationTimeStr = Model.NotificationTime?.ToString(@"hh\:mm") ?? "09:00";

    // بررسی حالت append
    bool isAppendMode = ViewData["AppendMode"] is true;
}

@* محتوای کارت یادآوری *@
<div class="card border-warning mb-3 reminder-item" data-reminder-id="@reminderId">
    <div class="card-header bg-warning-light">
        <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
                <i class="fa fa-bell-o me-1"></i>
                @Model.Title
            </h6>
            <button type="button"
                    class="btn btn-sm btn-outline-danger"
                    data-toggle="modal-ajax"
                    href="@Url.Action("DeleteReminderConfirmModal", "Tasks", new { reminderId = reminderId })">
                <i class="fa fa-trash me-1"></i>حذف
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <p class="mb-2">@Model.Description</p>
                }
                else
                {
                    <p class="mb-2 text-muted fst-italic">بدون توضیحات</p>
                }
                <small class="text-muted">
                    <i class="fa fa-clock me-1"></i>نوع: <strong>@typeText</strong> |
                    <i class="fa fa-calendar me-1"></i>زمان‌بندی: <strong>@scheduleText</strong> |
                    <i class="fa fa-bell me-1"></i>ساعت: <strong>@notificationTimeStr</strong>
                </small>
            </div>
            <div class="col-md-4 text-end">
                <span class="badge bg-warning text-dark">سفارشی</span>
                @if (isAppendMode)
                {
                    <span class="badge bg-success text-white ms-1">
                        <i class="fa fa-check-circle me-1"></i>جدید
                    </span>
                }
            </div>
        </div>

        @* داده‌های مخفی برای ارسال به سرور *@
        <input type="hidden" class="reminder-data"
               data-title="@Model.Title"
               data-description="@(Model.Description ?? "")"
               data-type="@Model.ReminderType"
               data-time="@(Model.NotificationTime?.ToString(@"hh\:mm\:ss") ?? "09:00:00")"
               data-interval="@(Model.IntervalDays ?? 0)"
               data-days-before="@(Model.DaysBeforeDeadline ?? 0)"
               data-start-date="@(Model.StartDatePersian ?? "")">
    </div>
</div>

<style>
    .bg-warning-light {
        background-color: rgba(255, 193, 7, 0.1) !important;
    }

    .reminder-item {
        transition: all 0.3s ease;
        animation: fadeInUp 0.4s ease;
    }

        .reminder-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>