@model MyDayTasksViewModel
@{
    ViewData["Title"] = "تسک‌های من - همه روزها";
}

<!-- Hero -->
<div class="bg-body-light">
    <div class="content content-full">
        <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center">
            <h1 class="flex-grow-1 fs-3 fw-semibold my-2 my-sm-3">
                <i class="fa fa-calendar-day text-primary me-2"></i>
                تسک‌های من - همه روزها
            </h1>
            <nav class="flex-shrink-0 my-2 my-sm-0 ms-sm-3" aria-label="نشانگر مسیر">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a asp-action="Index">تسک‌ها</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">روز من</li>
                </ol>
            </nav>
        </div>
    </div>
</div>
<!-- END Hero -->

<!-- Page Content -->
<div class="content">
    <!-- آمار کلی -->
    <div class="row mb-4">
        <div class="col-lg-12">
            <div class="block block-rounded">
                <div class="block-header block-header-default">
                    <h3 class="block-title">
                        <i class="fa fa-chart-pie text-primary me-1"></i>
                        آمار کلی تسک‌های من
                    </h3>
                    <div class="block-options">
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="refreshTasks()">
                            <i class="fa fa-refresh"></i> بروزرسانی
                        </button>
                    </div>
                </div>
                <div class="block-content" id="myDayStatsContainer">
                    @await Html.PartialAsync("_MyDayStats", Model)
                </div>
            </div>
        </div>
    </div>

    <!-- تسک‌ها گروه‌بندی شده بر اساس تاریخ -->
    <div id="myDayTasksContainer">
        @await Html.PartialAsync("_MyDayTasksList", Model)
    </div>
</div>
<!-- END Page Content -->

@section Scripts {
    <script>
        $(document).ready(function() {
            // Auto-refresh every 5 minutes
            setInterval(function() {
                refreshTasks();
            }, 300000);
        });

        function refreshTasks() {
            location.reload();
        }

        function logWork(taskId) {
            var url = '@Url.Action("LogWorkModal")' + '?taskId=' + taskId;

            // Use existing modal system from main.js
            createAndShowModal(url);
        }

        function removeFromMyDay(taskId, plannedDate) {
            if (confirm('آیا مطمئن هستید که می‌خواهید این تسک را از روز خود حذف کنید؟')) {
                $.post('@Url.Action("RemoveFromMyDay")', {
                    taskId: taskId,
                    date: plannedDate,
                    __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                }).done(function(response) {
                    if (response.success) {
                        location.reload();
                    } else {
                        if (typeof Swal !== 'undefined') {
                            Swal.fire('خطا', response.message || 'خطا در حذف تسک', 'error');
                        } else {
                            alert('خطا: ' + (response.message || 'خطا در حذف تسک'));
                        }
                    }
                }).fail(function() {
                    if (typeof Swal !== 'undefined') {
                        Swal.fire('خطا', 'خطا در ارتباط با سرور', 'error');
                    } else {
                        alert('خطا در ارتباط با سرور');
                    }
                });
            }
        }
    </script>
}

@section Styles {
    <style>
        .list-group-item-action:hover {
            background-color: rgba(0,123,255,.05);
        }

        .progress-sm {
            height: 8px;
        }

        .btn-group-vertical .btn {
            margin-bottom: 2px;
        }

            .btn-group-vertical .btn:last-child {
                margin-bottom: 0;
            }

        .border-danger {
            border-color: #dc3545 !important;
        }

        .block-themed .block-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .no-gutters .col-lg-6:first-child {
            border-left: 1px solid #e9ecef;
        }

        @@media (max-width: 991.98px) {
            .no-gutters .col-lg-6:first-child {
                border-left: none;
                border-bottom: 1px solid #e9ecef;
            }
        }
    </style>
}