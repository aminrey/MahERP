@model List<TaskViewModel>

<div class="table-responsive">
    <table class="table table-bordered table-striped table-vcenter table-sm">
        <thead>
            <tr>
                <th class="text-center" style="width: 100px;">کد تسک</th>
                <th class="text-center">عنوان</th>
                <th class="text-center">دسته‌بندی</th>
                <th class="text-center" style="width: 100px;">اولویت</th>
                <th class="text-center" style="width: 120px;">مهلت انجام</th>
                <th class="text-center" style="width: 100px;">وضعیت</th>
                <th class="text-center" style="width: 150px;">عملیات</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Any())
            {
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="text-center">
                            <span class="badge bg-primary">@item.TaskCode</span>
                        </td>
                        <td class="text-start">
                            <a asp-action="Details" asp-route-id="@item.Id" class="fw-semibold text-decoration-none">@item.Title</a>
                            @if (!string.IsNullOrEmpty(item.Description))
                            {
                                <small class="d-block text-muted">@(item.Description.Length > 30 ? item.Description.Substring(0, 30) + "..." : item.Description)</small>
                            }
                        </td>
                        <td class="text-center">
                            @if (!string.IsNullOrEmpty(item.CategoryTitle))
                            {
                                <span class="badge bg-secondary">@item.CategoryTitle</span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td class="text-center">
                            @switch (item.TaskType)
                            {
                                case 0:
                                    <span class="badge bg-light text-dark">
                                        <i class="fa fa-tasks me-1"></i>عادی
                                    </span>
                                    break;
                                case 1:
                                    <span class="badge bg-warning">
                                        <i class="fa fa-exclamation-circle me-1"></i>مهم
                                    </span>
                                    break;
                                case 2:
                                    <span class="badge bg-danger">
                                        <i class="fa fa-fire me-1"></i>فوری
                                    </span>
                                    break;
                            }
                        </td>
                        <td class="text-center">
                            @if (item.DueDate.HasValue)
                            {
                                var persianDate = ConvertDateTime.ConvertMiladiToShamsi(item.DueDate, "yyyy/MM/dd");
                                if (item.DueDate.Value < DateTime.Now && !item.CompletionDate.HasValue)
                                {
                                    <span class="text-danger fw-bold">@persianDate</span>
                                }
                                else
                                {
                                    <span>@persianDate</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td class="text-center">
                            @if (item.CompletionDate.HasValue && item.ManagerApprovedDate.HasValue)
                            {
                                <span class="badge bg-success">تایید شده</span>
                            }
                            else if (item.CompletionDate.HasValue)
                            {
                                <span class="badge bg-primary">تکمیل شده</span>
                            }
                            else if (item.DueDate.HasValue && DateTime.Now > item.DueDate.Value)
                            {
                                <span class="badge bg-danger">تاخیردار</span>
                            }
                            else
                            {
                                <span class="badge bg-info">در حال انجام</span>
                            }
                        </td>
                        <td class="text-center">
                            <div class="btn-group btn-group-sm" role="group">
                                <a asp-action="Details" asp-route-id="@item.Id" 
                                   class="btn btn-sm btn-outline-primary" 
                                   data-bs-toggle="tooltip" title="جزئیات">
                                    <i class="fa fa-eye"></i>
                                </a>
                               
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="text-center py-3">
                        <div class="text-muted">
                            <i class="fa fa-inbox fa-2x mb-2"></i>
                            <p>هیچ تسکی یافت نشد</p>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>