@model ContractSearchViewModel
@{
    Layout = null;
}

<div class="modal-header">
    <h5 class="modal-title">جستجوی پیشرفته قرارداد</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
    <form id="contractAdvancedSearchForm" method="POST" action="@Url.Action("Search", "Contract")">
        @Html.AntiForgeryToken()

        <div class="row">
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="Title">عنوان قرارداد</label>
                    <input asp-for="Title" class="form-control" placeholder="جستجو در عنوان قرارداد">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="ContractNumber">شماره قرارداد</label>
                    <input asp-for="ContractNumber" class="form-control" placeholder="جستجو در شماره قرارداد">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="StakeholderId">طرف حساب</label>
                    <select asp-for="StakeholderId" asp-items="@(new SelectList(ViewBag.Stakeholders, "Id", "FullName", ""))" class="form-select">
                        <option value="">همه</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="ContractType">نوع قرارداد</label>
                    <select asp-for="ContractType" class="form-select">
                        <option value="">همه</option>
                        <option value="0">فروش</option>
                        <option value="1">خرید</option>
                        <option value="2">خدمات</option>
                        <option value="3">اجاره</option>
                        <option value="4">سایر</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="Status">وضعیت قرارداد</label>
                    <select asp-for="Status" class="form-select">
                        <option value="">همه</option>
                        <option value="0">پیش‌نویس</option>
                        <option value="1">فعال</option>
                        <option value="2">تمام شده</option>
                        <option value="3">لغو شده</option>
                        <option value="4">منقضی شده</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="IsActive">وضعیت</label>
                    <select asp-for="IsActive" class="form-select">
                        <option value="">همه</option>
                        <option value="true">فعال</option>
                        <option value="false">غیرفعال</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="MinContractValue">حداقل مبلغ قرارداد (تومان)</label>
                    <input asp-for="MinContractValue" class="form-control number-format" placeholder="مثال: 1000000">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="MaxContractValue">حداکثر مبلغ قرارداد (تومان)</label>
                    <input asp-for="MaxContractValue" class="form-control number-format" placeholder="مثال: 50000000">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="StartDateFrom">تاریخ شروع از</label>
                    <input asp-for="StartDateFrom" class="form-control date-picker-shamsi" placeholder="YYYY/MM/DD">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="StartDateTo">تاریخ شروع تا</label>
                    <input asp-for="StartDateTo" class="form-control date-picker-shamsi" placeholder="YYYY/MM/DD">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="EndDateFrom">تاریخ پایان از</label>
                    <input asp-for="EndDateFrom" class="form-control date-picker-shamsi" placeholder="YYYY/MM/DD">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="EndDateTo">تاریخ پایان تا</label>
                    <input asp-for="EndDateTo" class="form-control date-picker-shamsi" placeholder="YYYY/MM/DD">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="CreateDateFrom">تاریخ ایجاد از</label>
                    <input asp-for="CreateDateFrom" class="form-control date-picker-shamsi" placeholder="YYYY/MM/DD">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="CreateDateTo">تاریخ ایجاد تا</label>
                    <input asp-for="CreateDateTo" class="form-control date-picker-shamsi" placeholder="YYYY/MM/DD">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="CreatorUserId">ایجاد کننده</label>
                    <select asp-for="CreatorUserId" asp-items="@(new SelectList(ViewBag.Users, "Id", "FullName", ""))" class="form-select">
                        <option value="">همه</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4">
                    <label class="form-label" for="IncludeDeleted">نمایش موارد حذف شده</label>
                    <select asp-for="IncludeDeleted" class="form-select">
                        <option value="false">خیر</option>
                        <option value="true">بله</option>
                    </select>
                </div>
            </div>
        </div>
    </form>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-alt-secondary" data-bs-dismiss="modal">انصراف</button>
    <button type="button" class="btn btn-primary" data-save="modal-ajax-save">
        <i class="fa fa-search me-1"></i> جستجو
    </button>
</div>

<script>
    $(document).ready(function() {
        // تنظیمات تاریخ شمسی
        $('.date-picker-shamsi').persianDatepicker({
            format: 'YYYY/MM/DD',
            initialValueType: 'persian',
            autoClose: true
        });

        // پردازش فرم جستجو
        $('[data-save="modal-ajax-save"]').click(function() {
            var form = $('#contractAdvancedSearchForm');
            $.post(form.attr('action'), form.serialize(), function(response) {
                if (response.status === 'redirect') {
                    window.location.href = response.redirectUrl;
                }
            });
        });
    });
</script>