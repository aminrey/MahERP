@model MahERP.DataModelLayer.ViewModels.OrganizationViewModels.TeamMemberViewModel

<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">ویرایش عضو: @Model.UserFullName</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <form asp-action="EditMemberSubmit" method="post">
            @Html.AntiForgeryToken()
            
            <div class="modal-body">
                <input type="hidden" asp-for="Id" />
                <input type="hidden" asp-for="TeamId" />
                <input type="hidden" asp-for="UserId" />
                <input type="hidden" asp-for="AddedByUserId" />
                
                <!-- نمایش اطلاعات کاربر -->
                <div class="alert alert-info d-flex align-items-center mb-3">
                    <i class="fa fa-info-circle me-2"></i>
                    <div>
                        <strong>تیم:</strong> @Model.TeamTitle<br>
                        <strong>عضو:</strong> @Model.UserFullName
                    </div>
                </div>

                <!-- نمایش نام کاربر (غیرقابل تغییر) -->
                <div class="mb-3">
                    <label class="form-label">نام کاربر</label>
                    <input type="text" class="form-control bg-light" value="@Model.UserFullName" readonly />
                    <div class="form-text">
                        <small class="text-muted">
                            <i class="fa fa-lock me-1"></i>
                            تغییر کاربر امکان‌پذیر نیست. برای تغییر کاربر، عضو را حذف و مجدداً اضافه کنید.
                        </small>
                    </div>
                </div>

                <!-- انتخاب سمت -->
                <div class="mb-3">
                    <label asp-for="PositionId" class="form-label">سمت در تیم</label>
                    <select asp-for="PositionId" class="form-select" asp-items="ViewBag.AvailablePositions">
                    </select>
                    <span asp-validation-for="PositionId" class="text-danger"></span>
                    <div class="form-text">
                        <small class="text-info">
                            <i class="fa fa-info-circle me-1"></i>
                            انتخاب سمت تأثیر بر مجوزهای مشاهده تسک خواهد داشت
                        </small>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <!-- عنوان سمت دستی -->
                        <div class="mb-3">
                            <label asp-for="Position" class="form-label">عنوان سمت (دستی)</label>
                            <input asp-for="Position" class="form-control" placeholder="سمت در تیم" />
                            <span asp-validation-for="Position" class="text-danger"></span>
                            <div class="form-text">
                                <small class="text-muted">این فیلد در صورت عدم انتخاب سمت از لیست بالا استفاده می‌شود</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <!-- نوع عضویت -->
                        <div class="mb-3">
                            <label asp-for="MembershipType" class="form-label">نوع عضویت</label>
                            <select asp-for="MembershipType" class="form-select" asp-items="ViewBag.MembershipTypes">
                            </select>
                            <span asp-validation-for="MembershipType" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- شرح نقش -->
                <div class="mb-3">
                    <label asp-for="RoleDescription" class="form-label">شرح نقش</label>
                    <textarea asp-for="RoleDescription" class="form-control" rows="2" placeholder="شرح نقش کاربر در تیم (اختیاری)"></textarea>
                    <span asp-validation-for="RoleDescription" class="text-danger"></span>
                </div>

                <!-- وضعیت فعال -->
                <div class="form-check">
                    <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                    <label asp-for="IsActive" class="form-check-label">عضویت فعال</label>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">انصراف</button>
                <button type="submit" class="btn btn-primary" data-save="modal-ajax-save">
                    <i class="fa fa-save me-1"></i> ذخیره تغییرات
                </button>
            </div>
        </form>
    </div>
</div>

<script>
$(document).ready(function() {
    // هنگام تغییر انتخاب سمت، فیلد عنوان سمت دستی را غیرفعال کن
    $('#PositionId').on('change', function() {
        var selectedPosition = $(this).val();
        if (selectedPosition) {
            $('#Position').prop('disabled', true).val('');
        } else {
            $('#Position').prop('disabled', false);
        }
    });

    // اگر در ابتدا سمت انتخاب شده، فیلد دستی را غیرافعال کن
    if ($('#PositionId').val()) {
        $('#Position').prop('disabled', true);
    }
});
</script>