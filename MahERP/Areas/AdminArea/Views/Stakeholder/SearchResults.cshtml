@model List<Stakeholder>
@{
    ViewData["Title"] = "نتایج جستجوی طرف حساب‌ها";
    var searchModel = ViewBag.SearchModel as StakeholderSearchViewModel;
}

<!-- Hero -->
<div class="bg-body-light">
    <div class="content content-full">
        <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center">
            <h1 class="flex-grow-1 fs-3 fw-semibold my-2 my-sm-3">نتایج جستجوی طرف حساب‌ها</h1>
            <nav class="flex-shrink-0 my-2 my-sm-0 ms-sm-3" aria-label="نشانگر مسیر">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">مدیریت</li>
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index", "Stakeholder")">طرف حساب‌ها</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">نتایج جستجو</li>
                </ol>
            </nav>
        </div>
    </div>
</div>
<!-- END Hero -->

<!-- Page Content -->
<div class="content">
    <!-- Search Summary -->
    <div class="block block-rounded">
        <div class="block-content block-content-full bg-body-light">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="mb-1">نتایج جستجو</h4>
                    <p class="text-muted mb-0">
                        <strong>@Model.Count</strong> طرف حساب یافت شد
                        @if (searchModel != null)
                        {
                            @if (!string.IsNullOrEmpty(searchModel.Name))
                            {
                                <span class="badge bg-primary me-1">نام: @searchModel.Name</span>
                            }
                            @if (!string.IsNullOrEmpty(searchModel.CompanyName))
                            {
                                <span class="badge bg-primary me-1">شرکت: @searchModel.CompanyName</span>
                            }
                            @if (!string.IsNullOrEmpty(searchModel.Phone))
                            {
                                <span class="badge bg-primary me-1">تلفن: @searchModel.Phone</span>
                            }
                            @if (!string.IsNullOrEmpty(searchModel.Email))
                            {
                                <span class="badge bg-primary me-1">ایمیل: @searchModel.Email</span>
                            }
                            @if (searchModel.StakeholderType.HasValue)
                            {
                                <span class="badge bg-primary me-1">نوع: @(searchModel.StakeholderType switch {
                                    0 => "مشتری",
                                    1 => "تامین کننده",
                                    2 => "همکار",
                                    3 => "سایر",
                                    _ => "نامشخص"
                                })</span>
                            }
                            @if (searchModel.IsActive.HasValue)
                            {
                                <span class="badge bg-primary me-1">وضعیت: @(searchModel.IsActive.Value ? "فعال" : "غیرفعال")</span>
                            }
                            @if (searchModel.IncludeDeleted)
                            {
                                <span class="badge bg-warning me-1">شامل حذف شده‌ها</span>
                            }
                        }
                    </p>
                </div>
                <div class="col-md-4 text-md-end">
                    <a href="@Url.Action("Index", "Stakeholder")" class="btn btn-alt-secondary me-1">
                        <i class="fa fa-arrow-left me-1"></i> بازگشت به لیست اصلی
                    </a>
                    <a href="@Url.Action("AdvancedSearch", "Stakeholder")" class="btn btn-primary" data-toggle="modal-ajax">
                        <i class="fa fa-search me-1"></i> جستجوی جدید
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- END Search Summary -->

    @if (Model.Any())
    {
        <!-- Results -->
        <div class="block block-rounded">
            <div class="block-header block-header-default">
                <h3 class="block-title">نتایج جستجو</h3>
                <div class="block-options">
                    <span class="badge bg-primary">@Model.Count طرف حساب</span>
                    <a href="@Url.Action("ExportToExcel", "Stakeholder", searchModel)" class="btn btn-sm btn-alt-success ms-2">
                        <i class="fa fa-file-excel me-1"></i> خروجی اکسل
                    </a>
                </div>
            </div>
            <div class="block-content">
                <!-- Stakeholders Table -->
                <div class="table-responsive">
                    <table class="table table-borderless table-striped table-vcenter">
                        <thead>
                            <tr>
                                <th class="text-center" style="width: 80px;">شناسه</th>
                                <th class="text-center">نام</th>
                                <th class="text-center d-none d-sm-table-cell">شرکت</th>
                                <th class="text-center d-none d-lg-table-cell">تلفن</th>
                                <th class="text-center d-none d-lg-table-cell">ایمیل</th>
                                <th class="text-center d-none d-sm-table-cell">نوع</th>
                                <th class="text-center d-none d-xl-table-cell">تاریخ ثبت</th>
                                <th class="text-center" style="width: 100px;">وضعیت</th>
                                <th class="text-center" style="width: 180px;">عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr class="@(item.IsDeleted ? "table-danger" : "")">
                                    <td class="text-center fs-sm">
                                        <a href="@Url.Action("Details", "Stakeholder", new { id = item.Id })">
                                            <strong>@item.Id</strong>
                                        </a>
                                    </td>
                                    <td class="text-center fw-semibold fs-sm">
                                        <a href="@Url.Action("Details", "Stakeholder", new { id = item.Id })">
                                            @item.FirstName @item.LastName
                                            @if (item.IsDeleted)
                                            {
                                                <span class="badge bg-danger ms-1">حذف شده</span>
                                            }
                                        </a>
                                    </td>
                                    <td class="text-center d-none d-sm-table-cell fs-sm">
                                        @(string.IsNullOrEmpty(item.CompanyName) ? "-" : item.CompanyName)
                                    </td>
                                    <td class="text-center d-none d-lg-table-cell fs-sm">
                                        @(!string.IsNullOrEmpty(item.Mobile) ? item.Mobile : (!string.IsNullOrEmpty(item.Phone) ? item.Phone : "-"))
                                    </td>
                                    <td class="text-center d-none d-lg-table-cell fs-sm">
                                        @(string.IsNullOrEmpty(item.Email) ? "-" : item.Email)
                                    </td>
                                    <td class="text-center d-none d-sm-table-cell">
                                        @switch (item.StakeholderType)
                                        {
                                            case 0:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-info-light text-info">مشتری</span>
                                                break;
                                            case 1:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-primary-light text-primary">تامین کننده</span>
                                                break;
                                            case 2:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-success-light text-success">همکار</span>
                                                break;
                                            case 3:
                                                <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-warning-light text-warning">سایر</span>
                                                break;
                                        }
                                    </td>
                                    <td class="text-center d-none d-xl-table-cell fs-sm">
                                        @ConvertDateTime.ConvertMiladiToShamsi(item.CreateDate, "yyyy/MM/dd")
                                    </td>
                                    <td class="text-center">
                                        @if (item.IsDeleted)
                                        {
                                            <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-danger-light text-danger">حذف شده</span>
                                        }
                                        else if (item.IsActive)
                                        {
                                            <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-success-light text-success">فعال</span>
                                        }
                                        else
                                        {
                                            <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-danger-light text-danger">غیرفعال</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <a href="@Url.Action("Details", "Stakeholder", new { id = item.Id })" class="btn btn-sm btn-alt-secondary me-1" data-bs-toggle="tooltip" title="مشاهده">
                                            <i class="fa fa-fw fa-eye"></i>
                                        </a>

                                        @if (!item.IsDeleted)
                                        {
                                            <a href="@Url.Action("EditStakeholder", "Stakeholder", new { id = item.Id })" class="btn btn-sm btn-alt-secondary me-1" data-bs-toggle="tooltip" title="ویرایش">
                                                <i class="fa fa-fw fa-pencil-alt"></i>
                                            </a>
                                            <button type="button" class="btn btn-sm btn-alt-secondary me-1" data-bs-toggle="tooltip" title="@(item.IsActive ? "غیرفعال کردن" : "فعال کردن")"
                                                href="@Url.Action("ActiveOrDeactiveStakeholder", "Stakeholder", new { id = item.Id })" data-toggle="modal-ajax">
                                                <i class="fa fa-fw @(item.IsActive ? "fa-ban" : "fa-check")"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-alt-danger" data-bs-toggle="tooltip" title="حذف"
                                                 href="@Url.Action("DeleteStakeholder", "Stakeholder", new { id = item.Id })" data-toggle="modal-ajax">
                                                <i class="fa fa-fw fa-trash-alt"></i>
                                            </button>
                                        }
                                        else
                                        {
                                            <span class="text-muted fs-sm">حذف شده</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <!-- END Stakeholders Table -->
            </div>
        </div>
        <!-- END Results -->
    }
    else
    {
        <!-- No Results -->
        <div class="block block-rounded">
            <div class="block-content text-center py-5">
                <i class="fa fa-search fa-3x text-muted mb-3"></i>
                <h3 class="mb-3">هیچ طرف حسابی یافت نشد</h3>
                <p class="text-muted mb-4">با معیارهای جستجوی انتخابی، هیچ طرف حسابی پیدا نشد. لطفاً معیارهای جستجو را تغییر دهید و دوباره تلاش کنید.</p>
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="d-grid gap-2 d-md-block">
                            <a href="@Url.Action("AdvancedSearch", "Stakeholder")" class="btn btn-primary" data-toggle="modal-ajax">
                                <i class="fa fa-search me-1"></i> جستجوی جدید
                            </a>
                            <a href="@Url.Action("AddStakeholder", "Stakeholder")" class="btn btn-success">
                                <i class="fa fa-plus me-1"></i> افزودن طرف حساب جدید
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END No Results -->
    }

    <!-- Quick Actions for Results -->
    @if (Model.Any())
    {
        <div class="block block-rounded">
            <div class="block-content block-content-full bg-body-light">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="mb-2">عملیات سریع:</h6>
                        <div class="btn-group" role="group">
                            <a href="@Url.Action("AddStakeholder", "Stakeholder")" class="btn btn-sm btn-success">
                                <i class="fa fa-plus me-1"></i> افزودن جدید
                            </a>
                            <a href="@Url.Action("ExportToExcel", "Stakeholder", searchModel)" class="btn btn-sm btn-alt-success">
                                <i class="fa fa-file-excel me-1"></i> خروجی اکسل
                            </a>
                        </div>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <h6 class="mb-2">آمار نتایج:</h6>
                        <div class="row text-center">
                            <div class="col-3">
                                <span class="badge bg-info p-2">
                                    @Model.Count(s => s.StakeholderType == 0) مشتری
                                </span>
                            </div>
                            <div class="col-3">
                                <span class="badge bg-primary p-2">
                                    @Model.Count(s => s.StakeholderType == 1) تامین کننده
                                </span>
                            </div>
                            <div class="col-3">
                                <span class="badge bg-success p-2">
                                    @Model.Count(s => s.IsActive && !s.IsDeleted) فعال
                                </span>
                            </div>
                            <div class="col-3">
                                <span class="badge bg-danger p-2">
                                    @Model.Count(s => s.IsDeleted) حذف شده
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
<!-- END Page Content -->

<!-- Modal Container for dynamic content -->
<div class="modal fade" id="modal-stakeholder" tabindex="-1" role="dialog" aria-labelledby="modal-stakeholder" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <!-- Dynamic content will be loaded here -->
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa fa-3x fa-spinner fa-spin text-primary my-3"></i>
                    <h3 class="mt-2 mb-3">در حال بارگذاری...</h3>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        // Function to open modal and load content
        function openModal(url) {
            $('#modal-stakeholder .modal-content').html('<div class="modal-body text-center"><i class="fa fa-3x fa-spinner fa-spin text-primary my-3"></i><h3 class="mt-2 mb-3">در حال بارگذاری...</h3></div>');
            $('#modal-stakeholder').modal('show');

            // Load content via AJAX
            $.get(url, function(data) {
                $('#modal-stakeholder .modal-content').html(data);
            });
        }

        // Initialize tooltips
        $(document).ready(function() {
            $('[data-bs-toggle="tooltip"]').tooltip();
        });
    </script>
}