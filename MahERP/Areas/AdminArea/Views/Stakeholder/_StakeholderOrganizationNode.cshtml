@model MahERP.DataModelLayer.ViewModels.StakeholderViewModels.StakeholderOrganizationViewModel

<div class="org-node" data-level="@Model.Level">
    <div class="org-card">
        <!-- عنوان واحد -->
        <div class="org-title">
            <i class="fa fa-building-o me-1"></i>
            @Model.Title
        </div>

        <!-- مدیر واحد -->
        <div class="org-manager">
            <i class="fa fa-user-tie fa-sm"></i>
            @if (!string.IsNullOrEmpty(Model.ManagerName))
            {
                <span>@Model.ManagerName</span>
            }
            else
            {
                <span class="manager-empty">مدیر تعیین نشده</span>
            }
        </div>

        <!-- آمار واحد -->
        <div class="org-stats">
            <div class="stat-item">
                <span class="stat-number">@(Model.Positions?.Count ?? 0)</span>
                <span class="stat-label">سمت</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">@(Model.Members?.Count ?? 0)</span>
                <span class="stat-label">عضو</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">@(Model.ChildOrganizations?.Count ?? 0)</span>
                <span class="stat-label">زیرمجموعه</span>
            </div>
        </div>

        <!-- توضیحات -->
        @if (!string.IsNullOrEmpty(Model.Description))
        {
            <div class="org-description" style="font-size: 0.85rem; opacity: 0.9; margin: 8px 0;">
                <i class="fa fa-info-circle fa-sm me-1"></i>
                @Model.Description
            </div>
        }

        <!-- دکمه‌های عملیات -->
        <div class="org-actions">
            <a asp-action="EditOrganization" asp-route-id="@Model.Id" 
               class="btn btn-sm btn-light" title="ویرایش">
                <i class="fa fa-edit"></i>
            </a>
            <a asp-action="AddOrganization" 
               asp-route-stakeholderId="@Model.StakeholderId"
               asp-route-parentOrganizationId="@Model.Id"
               class="btn btn-sm btn-light" title="افزودن زیرمجموعه">
                <i class="fa fa-plus"></i>
            </a>
            <a asp-action="ManagePositions" asp-route-organizationId="@Model.Id" 
               class="btn btn-sm btn-light" title="مدیریت سمت‌ها">
                <i class="fa fa-id-badge"></i>
            </a>
            <a asp-action="AddOrganizationMember" asp-route-organizationId="@Model.Id" 
               class="btn btn-sm btn-light" title="افزودن عضو">
                <i class="fa fa-user-plus"></i>
            </a>
            <a asp-action="OrganizationDetails" asp-route-id="@Model.Id" 
               class="btn btn-sm btn-light" title="جزئیات">
                <i class="fa fa-eye"></i>
            </a>
        </div>
    </div>

    <!-- نمایش زیرمجموعه‌ها -->
    @if (Model.ChildOrganizations != null && Model.ChildOrganizations.Any())
    {
        <div class="child-orgs">
            @foreach (var child in Model.ChildOrganizations)
            {
                @await Html.PartialAsync("_StakeholderOrganizationNode", child)
            }
        </div>
    }
</div>