# ?? ????? ???????? ????? ?????? - MahERP

## ?? ???? ???

??? ????? ?? ???? ?????? ???????? ????? ?? ???? ???????? ?????? ?? ???? **??? ?????** ? **?????? ????** ????? ??????.

---

## ?? ????????

### ? ???????? ???? ?? ???? ??? ?????
- **????? ??? ???**: ???? "?????? ???" + "??? ?????"
- **????? ?????? ??????**: ???? "???? ??????" + "??????? ?????"
- **??????? ??????**: ???? "?????? ???" + "????? ??"
- **???????**: ???? "???????" + "??? ????????"

### ? ??????? ???? ?? ?? ?????
- `Overload` ??? ???? ??????? ?? ????? ?????
- ??? `Context` ?????? ???????? ??????? ????? ???? ??????

---

## ?? ???? ???????

### 1?? ??????? ???? (???? Context - ???????? ???????)

```csharp
await _telegramService.SendNotificationAsync(
    message: "????? ??? ????? ?? ??? ?????? ????",
    chatId: user.TelegramChatId.Value,
    botToken: "YOUR_BOT_TOKEN"
);
```

**????? ??????:**
```
?? ???? ??????
```

---

### 2?? ??????? ??????? (?? Context - ???????? ????)

```csharp
// ? ???? Context
var context = new NotificationContext
{
    BaseUrl = "https://yourdomain.com",
    TaskId = "123",
    EventType = 1, // TaskAssigned
    HasPendingTasksList = false,
    RecipientUserId = userId,
    TaskTitle = "????? ???????? API",
    TaskPriority = 2 // ????
};

await _telegramService.SendNotificationAsync(
    message: "?? ??? ????: ????? ???????? API",
    chatId: user.TelegramChatId.Value,
    botToken: "YOUR_BOT_TOKEN",
    notificationContext: context
);
```

**????? ??????:**
```
?? ?????? ???
?? ??? ?????
?? ??? ????????
```

---

### 3?? ??????? ?? NotificationManagementService (??????)

?? ????? ?? `SendTelegramNotificationAsync` ?? ???? ?????? `Context` ?? ???????:

```csharp
// ? ??? ?? ?? NotificationManagementService.cs ????? ???
var notificationContext = await BuildNotificationContextAsync(coreNotificationId, userId);

await _telegramService.SendNotificationAsync(
    message,
    user.TelegramChatId.Value,
    botToken,
    notificationContext // ? Context ?????? ????? ??????
);
```

---

## ?? ??? ???????? (EventType)

| ?? | ??? ?????? | ???????? ????? ??? |
|----|-----------|---------------------|
| `1` | `TaskAssigned` | ?????? ??? + ??? ????? |
| `3` | `TaskDeadlineReminder` | ?????? ??? + ????? ?? |
| `4` | `TaskCommentAdded` | ?????? ??? + ??? ????? |
| `5` | `TaskUpdated` | ?????? ??? + ??? ????? |
| `13` | `DailyTaskDigest` | ???? ?????? + ??????? ????? |

---

## ?? ????????? ?????

### ?? ?????? 1: ????? ??? ????
```csharp
var context = new NotificationContext
{
    BaseUrl = "https://erp.company.com",
    TaskId = "456",
    EventType = 1, // TaskAssigned
    TaskTitle = "????? ??????? ?????"
};
```
**???????:**
- `?? ?????? ???` ? `/TaskingArea/Tasks/Details/456`
- `?? ??? ?????` ? `/TaskingArea/Tasks/Details/456#comments`
- `?? ??? ????????` ? `/AppCoreArea/Notification`

---

### ?? ?????? 2: ????? ?????? ??????? ????? ????

```csharp
var context = new NotificationContext
{
    BaseUrl = "https://erp.company.com",
    EventType = 13, // DailyTaskDigest
    HasPendingTasksList = true
};
```
**???????:**
- `?? ?????? ???? ??????` ? `/TaskingArea/Tasks/MyTasks`
- `?? ??????? ?????` ? `/TaskingArea/Tasks/MyTasks?filter=today`
- `?? ??? ????????` ? `/AppCoreArea/Notification`

---

### ?? ?????? 3: ??????? ??????

```csharp
var context = new NotificationContext
{
    BaseUrl = "https://erp.company.com",
    TaskId = "789",
    EventType = 3, // TaskDeadlineReminder
    TaskTitle = "????? ????? ??????"
};
```
**???????:**
- `?? ?????? ???` ? `/TaskingArea/Tasks/Details/789`
- `? ????? ??` ? `/TaskingArea/Tasks/CompleteTask/789`
- `?? ??? ????????` ? `/AppCoreArea/Notification`

---

## ?? ???????

### ?? ????? BaseUrl ?? appsettings.json

```json
{
  "AppSettings": {
    "BaseUrl": "https://yourdomain.com"
  }
}
```

### ?? ?????? BaseUrl ?? ??

```csharp
// ?? Constructor
private readonly IConfiguration _configuration;

public NotificationManagementService(IConfiguration configuration, ...)
{
    _configuration = configuration;
}

// ?? ??? BuildNotificationContextAsync
string baseUrl = _configuration["AppSettings:BaseUrl"] ?? "https://localhost";
```

---

## ?? ??? ???????

### ??? 1: ??? ??????

```csharp
var testContext = new NotificationContext
{
    BaseUrl = "https://test.com",
    TaskId = "TEST123",
    EventType = 1
};

await _telegramService.SendNotificationAsync(
    "?? ??? ???????? ????",
    testChatId,
    testBotToken,
    testContext
);
```

### ??? 2: ????? ??????

```csharp
_logger.LogInformation($"?? ???? ?? {buttons.Count} ???? ????? ??");
```

---

## ??? ????? ? ???????????

### ?????? ??? ?????? ????

1. ?? `Enums/NotificationEventType.cs` ?????
2. ??? ???? ????? ????
3. ?? `BuildDynamicKeyboard` ??? ???? ???????:

```csharp
if (context.EventType == 99) // ?????? ????
{
    buttons.Add(new List<InlineKeyboardButton>
    {
        InlineKeyboardButton.WithUrl("?? ?????? ????", $"{context.BaseUrl}/NewAction")
    });
}
```

---

## ?? ??????? ?????

- [Telegram Bot API - Inline Keyboards](https://core.telegram.org/bots/api#inlinekeyboardmarkup)
- [Telegram.Bot Library](https://github.com/TelegramBots/Telegram.Bot)

---

## ?? ????????

### ????: ??????? ????? ???? ????????

? **??????:**
1. ????? ???? `Context` ?? ??? ????????
2. `BaseUrl` ?? ?? ????
3. ??? `BuildDynamicKeyboard` ?? ????? ????

### ????: ???? ??????? ??? ???????

? **??????:**
1. `BaseUrl` ???? ???? `/` ?? ????? ????
2. ????? ???? `TaskId` ???? ???
3. ??????? URL ?? ?? ????? ??? ????

---

## ?? ????????

???? ?????? ? ??????:
- ?? Email: support@maherp.com
- ?? Telegram: @MahERP_Support

---

**????:** 1.0.0  
**?????:** 2024  
**??????:** MahERP Development Team
